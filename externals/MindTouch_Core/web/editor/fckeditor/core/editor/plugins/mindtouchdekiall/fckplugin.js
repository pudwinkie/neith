/*
 * FCKeditor - The text editor for Internet - http://www.fckeditor.net
 * Copyright (C) 2003-2008 Frederico Caldeira Knabben
 *
 * == BEGIN LICENSE ==
 *
 * Licensed under the terms of any of the following licenses at your
 * choice:
 *
 *  - GNU General Public License Version 2 or later (the "GPL")
 *    http://www.gnu.org/licenses/gpl.html
 *
 *  - GNU Lesser General Public License Version 2.1 or later (the "LGPL")
 *    http://www.gnu.org/licenses/lgpl.html
 *
 *  - Mozilla Public License Version 1.1 or later (the "MPL")
 *    http://www.mozilla.org/MPL/MPL-1.1.html
 *
 * == END LICENSE ==
 *
 * This file has been compressed for better performance.
 */
 
/*
 * MindTouch Deki - enterprise collaboration and integration platform
 * Copyright (C) 2006-2009 MindTouch, Inc.
 * www.mindtouch.com  oss@mindtouch.com
 *
 * For community documentation and downloads visit www.opengarden.org;
 * please review the licensing section.
 *
 * This program is free software; you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation; either version 2 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License along
 * with this program; if not, write to the Free Software Foundation, Inc.,
 * 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
 * http://www.gnu.org/copyleft/gpl.html
 */

String.prototype.utf8URL=parent.String.prototype.utf8URL;String.prototype.utf8ToString=parent.String.prototype.utf8ToString;var MindTouchDeki={};MindTouchDeki.$=parent.Deki.$;MindTouchDeki.InternalPrefix="mks://localhost/";MindTouchDeki.ExternalRegex=/^([a-z]+:)[\/]{2,5}/i;MindTouchDeki.EmailRegex=/^(mailto:)?[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?$/i;MindTouchDeki.IsLinkExternal=function(A){return (A.match(MindTouchDeki.ExternalRegex)!=null)&&A.indexOf(MindTouchDeki.InternalPrefix)!=0;};MindTouchDeki.IsLinkInternal=function(A){return (!(MindTouchDeki.IsLinkExternal(A)||MindTouchDeki.IsLinkNetwork(A)||MindTouchDeki.IsEmail(A)));};MindTouchDeki.IsLinkNetwork=function(A){return (A.indexOf("\\")==0)||(A.indexOf("//")==0);};MindTouchDeki.IsEmail=function(A){return MindTouchDeki.EmailRegex.test(A);};MindTouchDeki.IsUrl=function(A){var B=/(^(news|telnet|nttp|http|ftp|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?)|^(file:\/{2,5}([^\s\/\\:\*\?"<>#$&',:;\[`\{\|\}])+)/i;return B.test(A);};MindTouchDeki.EncodeURI=function(A){try{A=decodeURI(A);}catch(ex) {};A=unescape(A);A=A.replace(/([^0-9A-Za-z=:\/\\]+)/g,function(match,p1,offset,source){var B=match;var C=source.substr(0,offset);var D=source.substr(offset+match.length);var E=C.match(/\{\{/g);var F=D.match(/\}\}/g);if (!E||!F||E.length==F.length){B=encodeURI(match);};return B;});return A;};MindTouchDeki.HrefEncode=function(A){function hex(d){return (d<16)?("0"+d.toString(16)):d.toString(16);};if (typeof A.replace=='undefined'){A=A.toString();};var B=(A.indexOf(MindTouchDeki.InternalPrefix)==0);if (B){A=A.substr(MindTouchDeki.InternalPrefix.length);A=A.utf8URL();A=A.replace(/\x2F\x2F/g,"%2f%2f");A=A.replace(/\x2E/g,"%2e");A=MindTouchDeki.InternalPrefix+A;};return A;};MindTouchDeki.HrefDecode=function(A){if(typeof A.replace=='undefined'){A=A.toString();};A=A.replace(/&nbsp;/ig," ");A=unescape(A);A=A.utf8ToString();if (A.indexOf(MindTouchDeki.InternalPrefix)==0){A=A.replace(/_/ig," ");};return A;};MindTouchDeki.NormalizeUri=function(A){if (MindTouchDeki.IsEmail(A)){if (A.toLowerCase().indexOf('mailto:')!=0){A='mailto:'+A;};return A;};if (MindTouchDeki.IsLinkNetwork(A)){return 'file:///'+A.replace(/\\/g, '/');};if (MindTouchDeki.IsLinkExternal(A)){return A;};if (A!=""&&A.indexOf(MindTouchDeki.InternalPrefix)!=0&&A.indexOf('/')!=0){A=MindTouchDeki.InternalPrefix+A;};A=A.replace(/ /g,'_');return A;};MindTouchDeki.NormalizeLink=function(A){A.title=MindTouchDeki.HrefDecode(A.href);if (A.title.indexOf(MindTouchDeki.InternalPrefix)==0){A.title=A.title.substr(MindTouchDeki.InternalPrefix.length);MindTouchDeki.$(A).removeClass('external');}};MindTouchDeki.StripHost=function(A){var B=document.location.protocol+'//'+document.location.host;if (A.indexOf(B)==0){A=A.substring(B.length);};return A;};MindTouchDeki.GetUrlFromName=function(A,B){var C=MindTouchDeki.IsLinkInternal(A);if (C){if (A.indexOf(MindTouchDeki.InternalPrefix)==0){A=A.substr(MindTouchDeki.InternalPrefix.length);A='/index.php?title='+A;A=A.replace(/&[a-z]+=.*$/i,'');A=A.replace(/ /g,'_');if (B){A+="&contextid="+FCKConfig.PageId;}}}else{if (A.toLowerCase().indexOf('mailto:')==0){if (MindTouchDeki.IsEmail(A)){alert(FCKLang.ValidEmail);}else{alert(FCKLang.InvalidEmail);};return false;};if (!MindTouchDeki.IsUrl(A)){alert(FCKLang.InvalidUrl);return false;}};return A;};MindTouchDeki.GetInnerText=function(A){var B='',i;for (i=A.firstChild;i;i=i.nextSibling){if (i.nodeType==3){B+=i.data;}else if (i.nodeType==1){B+=MindTouchDeki.GetInnerText(i);}};return B;};MindTouchDeki.GetSelectedText=function(){if (FCKBrowserInfo.IsIE){var A=MindTouchDeki.CreateRange();return A.text;}else{var B=FCKSelection.GetSelection();return B.toString();}};MindTouchDeki.CreateRange=function(A){A=A||FCKSelection.GetSelection();var B=null;if (FCKBrowserInfo.IsIE){try{B=A.createRange();}catch(ex) {}}else{try{B=A.getRangeAt(0);}catch(ex){B=FCK.EditorDocument.createRange();}};return B;};MindTouchDeki.GetNextSibling=function(A,B){if (typeof (B)=='string') B=[B];var C=A.nextSibling;while(C){if (C.nodeType==1){if (C.tagName.Equals.apply(C.tagName,B)) return C;};C=C.nextSibling;};return null;};MindTouchDeki.GetPreviousSibling=function(A,B){if (typeof (B)=='string') B=[B];var C=A.previousSibling;while(C){if (C.nodeType==1){if (C.tagName.Equals.apply(C.tagName,B)) return C;};C=C.previousSibling;};return null;};MindTouchDeki.CheckTable=function(){if (FCKBrowserInfo.IsGecko){var A=FCKSelection.GetSelection();if (A.rangeCount>1){var B=FCKSelection.GetSelectedElement();if (B&&B.nodeName.toLowerCase()=='td'){return true;}}};return false;};MindTouchDeki.GetCurrentElementStyle=function(A,B){if (FCKBrowserInfo.IsIE){var C=B.split('-');for (var i=1;i<C.length;i++){var p=C[i];C[i]=p.charAt(0).toUpperCase()+p.substr(1);};B=C.join('');return A.currentStyle[B];}else return A.ownerDocument.defaultView.getComputedStyle(A,'').getPropertyValue(B);};MindTouchDeki.ScrollToTop=function(){if (FCKConfig.ToolbarLocation!="In"){var A=FCKTools.GetElementWindow(FCK.EditingArea.TargetElement);var B=A.frameElement;var C=FCKTools.GetElementDocument(B);var D=MindTouchDeki.$(B).position();var E=FCK.ToolbarSet._IFrame.offsetHeight;var F=D.top-E;if (MindTouchDeki.$(C).scrollTop()>F){parent.scrollTo(0,F);}}};MindTouchDeki.CopyAttributes=function(A,B,C){var D=A.attributes;for (var n=0;n<D.length;n++){var E=D[n];if (E.specified){var F=E.nodeName;if (F in C) continue;var G=A.getAttribute(F,2);if (G==null) G=E.nodeValue;B.setAttribute(F,G,0);}};if (A.style.cssText!==''||A.getAttribute('_fckstyle')) B.style.cssText=A.getAttribute('_fckstyle')||A.style.cssText;};MindTouchDeki.RenameNode=function(A,B){if (A.nodeType!=1) return null;if (A.nodeName==B) return A;var C=A.ownerDocument;var D=C.createElement(B);MindTouchDeki.CopyAttributes(A,D,{});FCKDomTools.MoveChildren(A,D);A.parentNode.replaceChild(D,A);return D;};MindTouchDeki.IsArray=function(o){return Object.prototype.toString.call(o)==='[object Array]';};MindTouchDeki.OpenDialog=function(A,B,C,D,E,F,G){var H=parent.Deki;var I=new H.Dialog({'src':B,'width':C,'height':D,'buttons':[H.Dialog.BTN_OK,H.Dialog.BTN_CANCEL],'args':E,'callback':F,'scope':G});I.render();I.show();};(function() {if (FCKConfig.ToolbarLocation!="In"){LoadScript(FCKConfig.PluginsPath+'mindtouchdeki/autogrow.js');var i=0,j=0,toolbarSet=FCKURLParams['Toolbar']||'Default';if (!FCKConfig.ToolbarSets[toolbarSet]) return;while (i<FCKConfig.ToolbarSets[toolbarSet].length){if (MindTouchDeki.IsArray(FCKConfig.ToolbarSets[toolbarSet][i])){j=0;while (j<FCKConfig.ToolbarSets[toolbarSet][i].length){if (FCKConfig.ToolbarSets[toolbarSet][i][j]=='FitWindow'){if (FCKConfig.ToolbarSets[toolbarSet][i].length==1){FCKConfig.ToolbarSets[toolbarSet].splice(i,1);break;}else{var A,howMany;if (j==0&&FCKConfig.ToolbarSets[toolbarSet][i][j+1]=='-'){A=j;howMany=2;}else if (j==FCKConfig.ToolbarSets[toolbarSet][i].length-1&&FCKConfig.ToolbarSets[toolbarSet][i][j-1]=='-'){A=j-1;howMany=2;}else if (FCKConfig.ToolbarSets[toolbarSet][i][j-1]=='-'&&FCKConfig.ToolbarSets[toolbarSet][i][j+1]=='-'){A=j-1;howMany=3;}else{A=j;howMany=1;};j=FCKConfig.ToolbarSets[toolbarSet][i].length-1-howMany;FCKConfig.ToolbarSets[toolbarSet][i].splice(A,howMany);}}else{j++;}}};i++;}}})();FCK.ContextMenu.RegisterListener({AddItems:function(A,B,C){var D=(C=='A'||FCKSelection.HasAncestorNode('A'));if (FCKCommands.GetCommand('MindTouchDeki_InsertLink').GetState()!=FCK_TRISTATE_DISABLED){var E=FCKSelection.MoveToAncestorNode('A');var F=(E&&E.name.length>0&&E.href.length==0);if (F) return;A.AddSeparator();if (D){A.AddItem('VisitLink',FCKLang.VisitLink);A.AddSeparator();A.AddItem('MindTouchDeki_InsertLink',FCKLang.EditLink,34);A.AddItem('Unlink',FCKLang.RemoveLink,35);}else{A.AddItem('MindTouchDeki_InsertLink',FCKLang.InsertLinkCM,34);}}}});FCK.ContextMenu.RegisterListener({AddItems:function(A,B,C){if (C=='IMG'&&!B.getAttribute('_fckfakelement')){A.AddSeparator();A.AddItem('MindTouchDeki_InsertImage',FCKLang.ImageProperties,37);}}});MindTouchDeki.GetChildNodes=function(A,B){var i,node,nodes=[];for (i=0;i<A.childNodes.length;i++){node=A.childNodes[i];if (node.nodeName.IEquals(B)){nodes.push(node);};if (node.childNodes.length){nodes=nodes.concat(MindTouchDeki.GetChildNodes(node,B));}};return nodes;};MindTouchDeki_MouseClickTarget=null;MindTouchDeki_OnMouseUp=function(A){if (MindTouchDeki_MouseClickTarget){var B=[],img,i;if (MindTouchDeki_MouseClickTarget.nodeName.toLowerCase()=='img'){B.push(MindTouchDeki_MouseClickTarget);}else{B=MindTouchDeki.GetChildNodes(MindTouchDeki_MouseClickTarget,'img');};for (i=0;i<B.length;i++){img=B[i];if (img.style.cssText.length>0){img.setAttribute('_fckstyle',img.style.cssText);}};MindTouchDeki_MouseClickTarget=null;}};MindTouchDeki_OnMouseDown=function(A){MindTouchDeki_MouseClickTarget=FCKTools.GetEventTarget(A);};FCK.Events.AttachEvent("OnAfterSetHTML",function(){if (FCK.EditMode!=FCK_EDITMODE_WYSIWYG||!FCK.EditorDocument) return;FCKTools.AddEventListener(FCK.EditorDocument,'mouseup',MindTouchDeki_OnMouseUp);FCKTools.AddEventListener(FCK.EditorDocument,'mousedown',MindTouchDeki_OnMouseDown);});MindTouchDeki_OnStatusChange=function(A,B){if (B==FCK_STATUS_COMPLETE){for (var i=0;i<FCK.ToolbarSet.Items.length;i++){var C=FCK.ToolbarSet.Items[i];if (C._UIButton&&C._UIButton.Style==FCK_TOOLBARITEM_ONLYICON){var D=C._UIButton.MainElement;if (D.firstChild&&D.firstChild.nodeName.toLowerCase()=='img'){D.firstChild.setAttribute('alt',C._UIButton.Tooltip);}}}}};FCK.Events.AttachEvent("OnStatusChange",MindTouchDeki_OnStatusChange);MindTouchDeki.GetState=function(){if (FCK.EditMode!=FCK_EDITMODE_WYSIWYG||!FCK.EditorWindow) return FCK_TRISTATE_DISABLED;var A=new FCKElementPath(FCKSelection.GetBoundaryParentElement(true));var B=A.Block||A.BlockLimit;if (!B||B.nodeName.toLowerCase()=='body') return FCK_TRISTATE_OFF;for (var i=0;i<A.Elements.length;i++){if (A.Elements[i].nodeName.IEquals(['h1'])&&FCK.EditorDocument.body.firstChild===A.Elements[i]){return FCK_TRISTATE_DISABLED;}};return FCK_TRISTATE_OFF;};
var FCKInlineStyle={GetNormalizedValue:function(A,B,C){var D=A.style,value='';C=C||B;switch (B){case 'backgroundImage':value=D.backgroundImage.replace(new RegExp("url\\('?([^']*)'?\\)",'gi'),"$1");break;case 'backgroundColor':case 'borderColor':if (D[B].length>0){value=this.ConvertRGBToHex(D[B]);}else if (B=='backgroundColor'&&FCKDomTools.HasAttribute(A,'bgColor')){value=FCKDomTools.GetAttributeValue(A,'bgColor');}else if (B=='borderColor'&&FCKDomTools.HasAttribute(A,'borderColor')){value=FCKDomTools.GetAttributeValue(A,'borderColor');};break;case 'borderStyle':value=D.borderStyle;if (value.match(/([^\s]*)\s/)) value=RegExp.$1;break;case 'borderWidth':value=FCKInlineStyle.GetNum(D.borderWidth);break;case 'whiteSpace':if (D.whiteSpace.length>0){value=D.whiteSpace;}else{if (A.attributes['noWrap']!=null&&A.attributes['noWrap'].specified&&oCell.noWrap) value='nowrap';};break;default:value=FCKInlineStyle.GetValue(A,B,C);};return value;},GetValue:function(A,B,C){var D='',st=A.style;C=C||B;if (FCKDomTools.HasAttribute(A,C)) D=FCKDomTools.GetAttributeValue(A,C);else if (st[B]) D=st[B];return D;},ConvertRGBToHex:function(A){var B=new RegExp("rgb\\s*\\(\\s*([0-9]+).*,\\s*([0-9]+).*,\\s*([0-9]+).*\\)","gi");var C=A.replace(B,"$1,$2,$3").split(',');if (C.length==3){r=parseInt(C[0]).toString(16);g=parseInt(C[1]).toString(16);b=parseInt(C[2]).toString(16);r=r.length==1?'0'+r:r;g=g.length==1?'0'+g:g;b=b.length==1?'0'+b:b;return "#"+r+g+b;};return A;},ConvertHexToRGB:function(A){if (A.indexOf('#')!=-1){A=A.replace(new RegExp('[^0-9A-F]','gi'),'');r=parseInt(A.substring(0,2),16);g=parseInt(A.substring(2,4),16);b=parseInt(A.substring(4,6),16);return "rgb("+r+","+g+","+b+")";};return A;},GetUnit:function(A){return A.replace(/[0-9]+(px|%|in|cm|mm|em|ex|pt|pc)/,'$1');},GetNum:function(A){A=parseInt(A);if (isNaN(A)){A='';};return A;}};
FCKCoreStyleCommand.prototype.GetState=function(){if (MindTouchDeki.GetState()==FCK_TRISTATE_DISABLED) return FCK_TRISTATE_DISABLED;return this.IsActive?FCK_TRISTATE_ON:FCK_TRISTATE_OFF;};FCKDialogCommand.prototype.GetState=function(){if (this.GetStateFunction) return this.GetStateFunction(this.GetStateParam);else if (this.Name=="Find"||this.Name=="Replace") return FCK.EditMode==FCK_EDITMODE_WYSIWYG?FCK_TRISTATE_OFF:FCK_TRISTATE_DISABLED;else return MindTouchDeki.GetState();};FCKFormatBlockCommand.prototype.GetState=function(){if (FCK.EditMode!=FCK_EDITMODE_WYSIWYG||!FCK.EditorWindow) return FCK_TRISTATE_DISABLED;var A=new FCKElementPath(FCKSelection.GetBoundaryParentElement(true));var B=A.Block||A.BlockLimit;if(B){if (B.nodeName.toLowerCase()=='h1'){var C=FCKDomTools.GetPreviousSourceElement(B,true,['body']);if (!C){return FCK_TRISTATE_DISABLED;}};for (var i=0;i<A.Elements.length;i++){if (A.Elements[i].nodeName.IEquals(['table','tr','td','th','tbody','thead','tfoot','caption'])){return FCK_TRISTATE_DISABLED;}}};return FCK_TRISTATE_OFF;};FCKFontNameCommand.prototype.GetState=MindTouchDeki.GetState;FCKFontSizeCommand.prototype.GetState=MindTouchDeki.GetState;FCKStyleCommand.prototype.GetState=function(){if (FCK.EditMode!=FCK_EDITMODE_WYSIWYG||!FCK.EditorDocument||MindTouchDeki.GetState()==FCK_TRISTATE_DISABLED) return FCK_TRISTATE_DISABLED;if (FCKSelection.GetType()=='Control'){var A=FCKSelection.GetSelectedElement();if (!A||!FCKStyles.CheckHasObjectStyle(A.nodeName.toLowerCase())) return FCK_TRISTATE_DISABLED;};return FCK_TRISTATE_OFF;};FCKTextColorCommand.prototype.GetState=MindTouchDeki.GetState;FCKIndentCommand.prototype.GetState=function(){if (MindTouchDeki.GetState()==FCK_TRISTATE_DISABLED) return FCK_TRISTATE_DISABLED;if (FCKIndentCommand._UseIndentClasses==undefined) FCKIndentCommand._InitIndentModeParameters();var A=FCKSelection.GetBoundaryParentElement(true);var B=FCKSelection.GetBoundaryParentElement(false);var C=FCKDomTools.GetCommonParentNode(A,B,['ul','ol']);if (C){if (this.Name.IEquals('outdent')) return FCK_TRISTATE_OFF;var D=FCKTools.GetElementAscensor(A,'li');if (!D||!D.previousSibling) return FCK_TRISTATE_DISABLED;return FCK_TRISTATE_OFF;};if (!FCKIndentCommand._UseIndentClasses&&this.Name.IEquals('indent')) return FCK_TRISTATE_OFF;var E=new FCKElementPath(A);var F=E.Block||E.BlockLimit;if (!F) return FCK_TRISTATE_DISABLED;if (FCKIndentCommand._UseIndentClasses){var G=F.className.match(FCKIndentCommand._ClassNameRegex);var H=0;if (G!=null){G=G[1];H=FCKIndentCommand._IndentClassMap[G];};if ((this.Name=='outdent'&&H==0)||(this.Name=='indent'&&H==FCKConfig.IndentClasses.length)) return FCK_TRISTATE_DISABLED;return FCK_TRISTATE_OFF;}else{var I=parseInt(F.style[this.IndentCSSProperty],10);if (isNaN(I)) I=0;if (I<=0) return FCK_TRISTATE_DISABLED;return FCK_TRISTATE_OFF;}};FCKJustifyCommand.prototype.GetState=function(){if (MindTouchDeki.GetState()==FCK_TRISTATE_DISABLED) return FCK_TRISTATE_DISABLED;var A=new FCKElementPath(FCKSelection.GetBoundaryParentElement(true));var B=A.Block||A.BlockLimit;if (!B||B.nodeName.toLowerCase()=='body') return FCK_TRISTATE_OFF;var C;if (FCKBrowserInfo.IsIE) C=B.currentStyle.textAlign;else C=FCK.EditorWindow.getComputedStyle(B,'').getPropertyValue('text-align');C=C.replace(/(-moz-|-webkit-|start|auto)/i,'');if ((!C&&this.IsDefaultAlign)||C==this.AlignValue) return FCK_TRISTATE_ON;return FCK_TRISTATE_OFF;};FCKListCommand.prototype.GetState=function(){if (MindTouchDeki.GetState()==FCK_TRISTATE_DISABLED) return FCK_TRISTATE_DISABLED;var A=FCKSelection.GetBoundaryParentElement(true);var B=A;while (B){if (B.nodeName.IEquals(['ul','ol'])) break;B=B.parentNode;};if (B&&B.nodeName.IEquals(this.TagName)) return FCK_TRISTATE_ON;else return FCK_TRISTATE_OFF;};FCKBlockQuoteCommand.prototype.GetState=function(){if (MindTouchDeki.GetState()==FCK_TRISTATE_DISABLED) return FCK_TRISTATE_DISABLED;if (FCK.EditMode!=FCK_EDITMODE_WYSIWYG||!FCK.EditorWindow) return FCK_TRISTATE_DISABLED;var A=new FCKElementPath(FCKSelection.GetBoundaryParentElement(true));var B=A.Block||A.BlockLimit;if (!B||B.nodeName.toLowerCase()=='body') return FCK_TRISTATE_OFF;for (var i=0;i<A.Elements.length;i++){if (A.Elements[i].nodeName.IEquals('blockquote')) return FCK_TRISTATE_ON;};return FCK_TRISTATE_OFF;};FCKToolbarSet.prototype.RefreshItemsState=function(A){var B=(A?A.ToolbarSet:this).Items;for (var i=0;i<B.length;i++) B[i].RefreshState();};FCKTextColorCommand.prototype.SetColor=function(A){FCKUndo.SaveUndoStep();var B=FCKStyles.GetStyle('_FCK_'+(this.Type=='ForeColor'?'Color':'BackColor'));var C=[];if (this.Type=='BackColor'){var D=new FCKDomRange(FCK.EditorWindow);D.MoveToSelection();C=FCKTableHandler.GetSelectedCells();if (C.length==1&&!D.CheckIsCollapsed()) C=[];};if (C.length>0){for (var i=0;i<C.length;i++){var E=C[i];A=A||'';E.style.backgroundColor=A;if (E.style.cssText.length>0){E.setAttribute('_fckstyle',E.style.cssText);}else{E.removeAttribute('style');E.removeAttribute('_fckstyle');}}}else if (!A||A.length==0) FCK.Styles.RemoveStyle(B);else{B.SetVariable('Color',A);FCKStyles.ApplyStyle(B);};FCKUndo.SaveUndoStep();FCK.Focus();FCK.Events.FireEvent('OnSelectionChange');};FCKJustifyCommand.prototype.Execute=function(){FCKUndo.SaveUndoStep();var A=new FCKDomRange(FCK.EditorWindow);A.MoveToSelection();var B=this.GetState();if (B==FCK_TRISTATE_DISABLED) return;if (FCKBrowserInfo.IsGecko){var C=FCKTableHandler.GetSelectedCells();if (C.length){for (var i=0;i<C.length;i++){this._SetAlign(C[i],B);};FCK.Focus();FCK.Events.FireEvent('OnSelectionChange');return;}};var D=A.CreateBookmark();var E=new FCKDomRangeIterator(A);var F;while ((F=E.GetNextParagraph())){this._SetAlign(F,B);};A.MoveToBookmark(D);A.Select();FCK.Focus();FCK.Events.FireEvent('OnSelectionChange');};FCKJustifyCommand.prototype._SetAlign=function(A,B){var C=this._CssClassName;A.removeAttribute('align');if (C){var D=A.className.replace(FCKJustifyCommand._GetClassNameRegex(),'');if (B==FCK_TRISTATE_OFF){if (D.length>0) D+=' ';A.className=D+C;}else if (D.length==0) FCKDomTools.RemoveAttribute(A,'class');}else{var E=A.style;if (B==FCK_TRISTATE_OFF) E.textAlign=this.AlignValue;else{E.textAlign='';if (E.cssText.length==0) A.removeAttribute('style');};if (E.cssText.length==0) A.removeAttribute('_fckstyle');else A.setAttribute('_fckstyle',E.cssText);}};FCKXHtml.GetXHTML=function(A,B,C){FCKDomTools.CheckAndRemovePaddingNode(FCKTools.GetElementDocument(A),FCKConfig.EnterMode);FCKXHtmlEntities.Initialize();if (!FCKConfig.ProcessHTMLEntities){FCKXHtmlEntities.Entities[' ']='nbsp';};this._NbspEntity='nbsp';var D=FCK.IsDirty();FCKXHtml.SpecialBlocks=[];this.XML=FCKTools.CreateXmlObject('DOMDocument');this.MainNode=this.XML.appendChild(this.XML.createElement('xhtml'));FCKXHtml.CurrentJobNum++;if (B) this._AppendNode(this.MainNode,A);else this._AppendChildNodes(this.MainNode,A,false);if (FCKBrowserInfo.IsIE) FCKXHtml._RemoveXHtmlJobProperties(A);var E=this._GetMainXmlString();this.XML=null;if (FCKBrowserInfo.IsSafari) E=E.replace(/^<xhtml.*?>/,'<xhtml>');E=E.substr(7,E.length-15).Trim();if (FCKConfig.DocType.length>0&&FCKRegexLib.HtmlDocType.test(FCKConfig.DocType)) E=E.replace(FCKRegexLib.SpaceNoClose,'>');else E=E.replace(FCKRegexLib.SpaceNoClose,' />');if (FCKConfig.ForceSimpleAmpersand) E=E.replace(FCKRegexLib.ForceSimpleAmpersand,'&');E=E.replace(FCKRegexLib.GeckoEntitiesMarker,'&');if (C) E=FCKCodeFormatter.Format(E);for (var i=0;i<FCKXHtml.SpecialBlocks.length;i++){var F=new RegExp('___FCKsi___'+i);E=E.replace(F,FCKXHtml.SpecialBlocks[i]);};if (!D) FCK.ResetIsDirty();FCKDomTools.EnforcePaddingNode(FCKTools.GetElementDocument(A),FCKConfig.EnterMode);return E;};function FCK_OnBlur(A){return;var B=A.ToolbarSet;if (B.CurrentInstance==A) B.Disable();};FCKVisitLinkCommand.prototype.Execute=function(){var A=FCKSelection.MoveToAncestorNode('A');var B=A.getAttribute('_fcksavedurl')||A.getAttribute('href',2);B=MindTouchDeki.GetUrlFromName(B,true);if (false==B) return;if (!/:\/\//.test(B)){var C=FCKConfig.BaseHref;var D=FCK.GetInstanceObject('parent');if (!C){C=D.document.location.href;C=C.substring(0,C.lastIndexOf('/')+1);};if (/^\//.test(B)){try{C=C.match(/^.*:\/\/+[^\/]+/)[0];}catch (e){C=D.document.location.protocol+'://'+D.parent.document.location.host;}};B=C+B;};if (!window.open(B,'_blank')) alert(FCKLang.VisitLinkBlocked);};FCKStyles.CheckSelectionChanges=function(){var A;if (MindTouchDeki.CheckTable()){var B=FCKTableHandler.GetSelectedCells();A=B[0].firstChild;}else{A=FCKSelection.GetBoundaryParentElement(true);};if (!A) return;var C=new FCKElementPath(A);var D=this.GetStyles();for (var E in D){var F=this._Callbacks[E];if (F){var G=D[E];var H=G.CheckActive(C);if (H!=(G._LastState||null)){G._LastState=H;for (var i=0;i<F.length;i++){var I=F[i][0];var J=F[i][1];I.call(J||window,E,H);}}}}};FCKDomTools.CloneElement=function(A,B){B=B||false;A=A.cloneNode(B);A.removeAttribute('id',false);A.removeAttribute('function',false);A.removeAttribute('block',false);A.removeAttribute('init',false);A.removeAttribute('foreach',false);A.removeAttribute('if',false);A.removeAttribute('where',false);A.removeAttribute('ctor',false);return A;};if (!FCKBrowserInfo.IsIE){FCKSelection.GetParentElement=function(){if (this.GetType()=='Control') return FCKSelection.GetSelectedElement().parentNode;else{var A=this.GetSelection();if (A){if (A.anchorNode&&A.anchorNode==A.focusNode){var B=A.getRangeAt(0);if ((B.collapsed||B.startContainer.nodeType==3)&&A.anchorNode.nodeName.toLowerCase()!='pre'){return A.anchorNode.parentNode;}else return A.anchorNode;};var C=new FCKElementPath(A.anchorNode);var D=new FCKElementPath(A.focusNode);var E=null;var F=null;if (C.Elements.length>D.Elements.length){E=C.Elements;F=D.Elements;}else{E=D.Elements;F=C.Elements;};var G=E.length-F.length;for(var i=0;i<F.length;i++){if (E[G+i]==F[i]) return F[i];};return null;}};return null;}};FCKSourceCommand.prototype.Execute=function(){if (FCKConfig.SourcePopup){var A=FCKConfig.ScreenWidth*0.65;var B=FCKConfig.ScreenHeight*0.65;FCKDialog.OpenDialog('FCKDialog_Source',FCKLang.Source,'dialog/fck_source.html',A,B,null,true);}else{FCK.SwitchEditMode();MindTouchDeki.ScrollToTop();}};if (!FCKBrowserInfo.IsIE){FCKXHtml._AppendAttributes=function(A,B,C){var D=B.attributes;for (var n=0;n<D.length;n++){var E=D[n];if (E.specified){var F=E.nodeName.toLowerCase();var G;if (F.StartsWith('_fck')) continue;else if (F.indexOf('_moz')==0) continue;else if (F=='class'){G=E.nodeValue.replace(FCKRegexLib.FCK_Class,'');if (G.length==0) continue;}else if (E.nodeValue===true) G=F;else{if (F=='style'&&B.hasAttribute('_fckstyle')){G=B.getAttribute('_fckstyle');}else{G=B.getAttribute(F,2);}};this._AppendAttribute(C,F,G);}}}}else{FCKXHtml._AppendAttributes=function(A,B,C,D){var E=B.attributes,bHasStyle;for (var n=0;n<E.length;n++){var F=E[n];if (F.specified){var G=F.nodeName.toLowerCase();var H;if (G.StartsWith('_fck')) continue;else if (G=='style'){bHasStyle=true;continue;}else if (G=='class'){H=F.nodeValue.replace(FCKRegexLib.FCK_Class,'');if (H.length==0) continue;}else if (G.indexOf('on')==0) H=F.nodeValue;else if (D=='body'&&G=='contenteditable') continue;else if (F.nodeValue===true) H=G;else{try{H=B.getAttribute(G,2);}catch (e) {}};this._AppendAttribute(C,G,H||F.nodeValue);}};if (bHasStyle||B.style.cssText.length>0||B.getAttribute('_fckstyle')){var I=FCKTools.ProtectFormStyles(B);var J=B.getAttribute('_fckstyle')||B.style.cssText;J=J.replace(FCKRegexLib.StyleProperties,FCKTools.ToLowerCase);FCKTools.RestoreFormStyles(B,I);this._AppendAttribute(C,'style',J);}}};FCKRegexLib.ProtectStyles=/<[^>\s]+?(?=\s)[^>]*?\sstyle=((?:(?:\s*)("|').*?\2)|(?:[^"'][^ >]+))/gi;FCK.ProtectStyles=function(A){A=A.replace(FCKRegexLib.ProtectStyles,'$& _fckstyle=$1');return A;};FCK.CustomDataProcessors=[];FCK.AddCustomDataProcessor=function(A,B){B=B||this;var C={fProcessor:A,oScope:B};FCK.CustomDataProcessors.push(C);};FCK.SetData=function(A,B){this.EditingArea.Mode=FCK.EditMode;if (FCKBrowserInfo.IsIE&&FCK.EditorDocument){FCK.EditorDocument.detachEvent("onselectionchange",Doc_OnSelectionChange);};FCKTempBin.Reset();FCK.Selection.Release();if (FCK.EditMode==FCK_EDITMODE_WYSIWYG){this._ForceResetIsDirty=(B===true);A=FCKConfig.ProtectedSource.Protect(A);A=FCK.DataProcessor.ConvertToHtml(A);A=A.replace(FCKRegexLib.InvalidSelfCloseTags,'$1></$2>');A=FCK.ProtectEvents(A);A=FCK.ProtectUrls(A);A=FCK.ProtectTags(A);for (var i=0;i<FCK.CustomDataProcessors.length;i++){oProcessor=FCK.CustomDataProcessors[i];A=oProcessor.fProcessor.call(oProcessor.oScope,A);};if (FCK.TempBaseTag.length>0&&!FCKRegexLib.HasBaseTag.test(A)) A=A.replace(FCKRegexLib.HeadOpener,'$&'+FCK.TempBaseTag);var C='';if (!FCKConfig.FullPage) C+=_FCK_GetEditorAreaStyleTags();if (FCKBrowserInfo.IsIE) C+=FCK._GetBehaviorsStyle();else if (FCKConfig.ShowBorders) C+=FCKTools.GetStyleHtml(FCK_ShowTableBordersCSS,true);C+=FCKTools.GetStyleHtml(FCK_InternalCSS,true);A=A.replace(FCKRegexLib.HeadCloser,C+'$&');this.EditingArea.OnLoad=_FCK_EditingArea_OnLoad;this.EditingArea.Start(A);}else{FCK.EditorWindow=null;FCK.EditorDocument=null;FCKDomTools.PaddingNode=null;this.EditingArea.OnLoad=null;this.EditingArea.Start(A);this.EditingArea.Textarea._FCKShowContextMenu=true;FCK.EnterKeyHandler=null;if (B) this.ResetIsDirty();FCK.KeystrokeHandler.AttachToElement(this.EditingArea.Textarea);this.EditingArea.Textarea.focus();FCK.Events.FireEvent('OnAfterSetHTML');};if (window.onresize) window.onresize();};FCK.AddCustomDataProcessor(FCK.ProtectStyles);FCKDomRange.prototype.MoveToElementEditEnd=function(A){var B;while (A&&A.nodeType==1){if (FCKDomTools.CheckIsEditable(A)) B=A;else if (B) break;A=A.firstChild;};if (B){this.SetStart(B,2);this.SetEnd(B,2);}};if (!FCKBrowserInfo.IsIE){FCK.InitializeBehaviors=function(){if (window.onresize) window.onresize();FCKFocusManager.AddWindow(this.EditorWindow);this.ExecOnSelectionChange=function(){FCK.Events.FireEvent("OnSelectionChange");};this._ExecDrop=function(evt){if (FCK.MouseDownFlag){FCK.MouseDownFlag=false;return;};if (FCKConfig.ForcePasteAsPlainText){if (evt.dataTransfer){var A=evt.dataTransfer.getData('Text');A=FCKTools.HTMLEncode(A);A=FCKTools.ProcessLineBreaks(window,FCKConfig,A);FCK.InsertHtml(A);}else if (FCKConfig.ShowDropDialog) FCK.PasteAsPlainText();evt.preventDefault();evt.stopPropagation();}};this._ExecCheckCaret=function(evt){if (FCK.EditMode!=FCK_EDITMODE_WYSIWYG) return;if (evt.type=='keypress'){var B=evt.keyCode;if (B<33||B>40) return;};var C=function(H){if (H.nodeType!=1) return false;var D=H.tagName.toLowerCase();return (FCKListsLib.BlockElements[D]||FCKListsLib.EmptyElements[D]);};var E=function(){var F=FCKSelection.GetSelection();var G=F.getRangeAt(0);if (!G||!G.collapsed) return;var H=G.endContainer;if (H.nodeType!=3) return;if (H.nodeValue.length!=G.endOffset) return;var I=H.nodeValue.lastIndexOf('\n');if (H.nodeValue.length>0&&I==(H.nodeValue.length-1)){G=FCK.EditorDocument.createRange();G.setStart(H,I);G.setEnd(H,I);F.removeAllRanges();F.addRange(G);FCK.Events.FireEvent("OnSelectionChange");return;};var J=H.parentNode.tagName.toLowerCase();if (!(J=='a'||(!FCKBrowserInfo.IsOpera&&String(H.parentNode.contentEditable)=='false')||(!(FCKListsLib.BlockElements[J]||FCKListsLib.NonEmptyBlockElements[J])&&B==35))) return;var K=FCKTools.GetNextTextNode(H,H.parentNode,C);if (K) return;G=FCK.EditorDocument.createRange();K=FCKTools.GetNextTextNode(H,H.parentNode.parentNode,C);if (K){if (FCKBrowserInfo.IsOpera&&B==37) return;G.setStart(K,0);G.setEnd(K,0);}else{while (H.parentNode&&H.parentNode!=FCK.EditorDocument.body&&H.parentNode!=FCK.EditorDocument.documentElement&&H==H.parentNode.lastChild&&(!FCKListsLib.BlockElements[H.parentNode.tagName.toLowerCase()]&&!FCKListsLib.NonEmptyBlockElements[H.parentNode.tagName.toLowerCase()])) H=H.parentNode;if (FCKListsLib.BlockElements[J]||FCKListsLib.EmptyElements[J]||H==FCK.EditorDocument.body){G.setStart(H,H.childNodes.length);G.setEnd(H,H.childNodes.length);}else{var L=H.nextSibling;while (L){if (L.nodeType!=1){L=L.nextSibling;continue;};var M=L.tagName.toLowerCase();if (FCKListsLib.BlockElements[M]||FCKListsLib.EmptyElements[M]||FCKListsLib.NonEmptyBlockElements[M]) break;L=L.nextSibling;};var N=FCK.EditorDocument.createTextNode('');if (L) H.parentNode.insertBefore(N,L);else H.parentNode.appendChild(N);G.setStart(N,0);G.setEnd(N,0);}};F.removeAllRanges();F.addRange(G);FCK.Events.FireEvent("OnSelectionChange");};setTimeout(E,1);};this.ExecOnSelectionChangeTimer=function(){if (FCK.LastOnChangeTimer) window.clearTimeout(FCK.LastOnChangeTimer);FCK.LastOnChangeTimer=window.setTimeout(FCK.ExecOnSelectionChange,100);};this.EditorDocument.addEventListener('mouseup',this.ExecOnSelectionChange,false);this.EditorDocument.addEventListener('keyup',this.ExecOnSelectionChangeTimer,false);this._DblClickListener=function(e){FCK.OnDoubleClick(e.target);e.stopPropagation();};this.EditorDocument.addEventListener('dblclick',this._DblClickListener,true);this.EditorDocument.addEventListener('keydown',this._KeyDownListener,false);if (FCKBrowserInfo.IsGecko){this.EditorWindow.addEventListener('dragdrop',this._ExecDrop,true);}else if (FCKBrowserInfo.IsSafari){this.EditorDocument.addEventListener('dragover',function (evt){if (!FCK.MouseDownFlag&&FCK.Config.ForcePasteAsPlainText) evt.returnValue=false;},true);this.EditorDocument.addEventListener('drop',this._ExecDrop,true);this.EditorDocument.addEventListener('mousedown',function(ev){var O=ev.srcElement;if (O.nodeName.IEquals('IMG','HR','INPUT','TEXTAREA','SELECT')){FCKSelection.SelectNode(O);}},true);this.EditorDocument.addEventListener('mouseup',function(ev){if (ev.srcElement.nodeName.IEquals('INPUT','TEXTAREA','SELECT')) ev.preventDefault()},true);this.EditorDocument.addEventListener('click',function(ev){if (ev.srcElement.nodeName.IEquals('INPUT','TEXTAREA','SELECT')) ev.preventDefault()},true);};if (FCKBrowserInfo.IsGecko||FCKBrowserInfo.IsOpera){this.EditorDocument.addEventListener('keypress',this._ExecCheckCaret,false);this.EditorDocument.addEventListener('click',this._ExecCheckCaret,false);};FCK.ContextMenu._InnerContextMenu.SetMouseClickWindow(FCK.EditorWindow);FCK.ContextMenu._InnerContextMenu.AttachToElement(FCK.EditorDocument);}};FCKListCommand.prototype._ChangeListType=function(A,B,C){if (A.contents.length==1){var D=A.contents[0];if (D.parentNode.nodeName.IEquals(['ul','ol'])){var E=MindTouchDeki.RenameNode(D.parentNode,this.TagName);E._FCK_ListGroupObject=null;return;}};var F=FCKDomTools.ListToArray(A.root,B);var G=[];for (var i=0;i<A.contents.length;i++){var D=A.contents[i];D=FCKTools.GetElementAscensor(D,'li');if (!D||D._FCK_ListItem_Processed) continue;G.push(D);FCKDomTools.SetElementMarker(B,D,'_FCK_ListItem_Processed',true);};var I=FCKTools.GetElementDocument(A.root).createElement(this.TagName);for (var i=0;i<G.length;i++){var J=G[i]._FCK_ListArray_Index;F[J].parent=I;};var E=FCKDomTools.ArrayToList(F,B);for (var i=0;i<E.listNode.childNodes.length;i++){if (E.listNode.childNodes[i].nodeName.IEquals(this.TagName)) C.push(E.listNode.childNodes[i]);};A.root.parentNode.replaceChild(E.listNode,A.root);};FCKRegexLib.HtmlTag=/<\/?\w+(?:(?:\s+(?:\w|\w[\w-]*\w)(?:\s*=\s*(?:\".*?\"|'.*?'|[^'\">\s]+))?)+\s*|\s*)\/?>/;FCK_POSITION_IDENTICAL=0;FCK_POSITION_DISCONNECTED=1;FCK_POSITION_PRECEDING=2;FCK_POSITION_FOLLOWING=4;FCK_POSITION_CONTAINS=8;FCK_POSITION_CONTAINED_BY=16;FCKDomTools.ComparePosition=function (a,b){return a.compareDocumentPosition?a.compareDocumentPosition(b):a.contains?(a!=b&&a.contains(b)&&FCK_POSITION_CONTAINED_BY)+(a!=b&&b.contains(a)&&FCK_POSITION_CONTAINS)+(a.sourceIndex>=0&&b.sourceIndex>=0?(a.sourceIndex<b.sourceIndex&&FCK_POSITION_FOLLOWING)+(a.sourceIndex>b.sourceIndex&&FCK_POSITION_PRECEDING):FCK_POSITION_DISCONNECTED)+FCK_POSITION_IDENTICAL:FCK_POSITION_IDENTICAL;};FCKListsLib.RemoveEmpty={abbr:1,acronym:1,address:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,s:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,'var':1};FCK.DTD=(function(){var X=FCKTools.Merge;var A,L,J,M,N,O,D,H,P,K,Q,F,G,C,B,E,I;A={isindex:1,fieldset:1};B={input:1,button:1,select:1,textarea:1,label:1};C=X({a:1},B);D=X({iframe:1},C);E={hr:1,ul:1,menu:1,div:1,blockquote:1,noscript:1,table:1,center:1,address:1,dir:1,pre:1,h5:1,dl:1,h4:1,noframes:1,h6:1,ol:1,h1:1,h3:1,h2:1};F={ins:1,del:1,script:1};G=X({b:1,acronym:1,bdo:1,'var':1,'#':1,abbr:1,code:1,br:1,i:1,cite:1,kbd:1,u:1,strike:1,s:1,tt:1,strong:1,q:1,samp:1,em:1,dfn:1,span:1},F);H=X({sub:1,img:1,object:1,sup:1,basefont:1,map:1,applet:1,font:1,big:1,small:1},G);I=X({p:1},H);J=X({iframe:1},H,B);K={img:1,noscript:1,br:1,kbd:1,center:1,button:1,basefont:1,h5:1,h4:1,samp:1,h6:1,ol:1,h1:1,h3:1,h2:1,form:1,font:1,'#':1,select:1,menu:1,ins:1,abbr:1,label:1,code:1,table:1,script:1,cite:1,input:1,iframe:1,strong:1,textarea:1,noframes:1,big:1,small:1,span:1,hr:1,sub:1,bdo:1,'var':1,div:1,object:1,sup:1,strike:1,dir:1,map:1,dl:1,applet:1,del:1,isindex:1,fieldset:1,ul:1,b:1,acronym:1,a:1,blockquote:1,i:1,u:1,s:1,tt:1,address:1,q:1,pre:1,p:1,em:1,dfn:1};L=X({a:1},J);M={tr:1};N={'#':1};O=X({param:1},K);P=X({form:1},A,D,E,I);Q={li:1};return {col:{},tr:{td:1,th:1},img:{},colgroup:{col:1},noscript:P,td:P,br:{},th:P,center:P,kbd:L,button:X(I,E),basefont:{},h5:L,h4:L,samp:L,h6:L,ol:Q,h1:L,h3:L,option:N,h2:L,form:X(A,D,E,I),select:{optgroup:1,option:1},font:L,ins:P,menu:Q,abbr:L,label:L,table:{thead:1,col:1,tbody:1,tr:1,colgroup:1,caption:1,tfoot:1},code:L,script:N,tfoot:M,cite:L,li:P,input:{},iframe:P,strong:L,textarea:N,noframes:P,big:L,small:L,span:L,hr:{},dt:L,sub:L,optgroup:{option:1},param:{},bdo:L,'var':L,div:P,object:O,sup:L,dd:P,strike:L,area:{},dir:Q,map:X({area:1,form:1,p:1},A,F,E),applet:O,dl:{dt:1,dd:1},del:P,isindex:{},fieldset:X({legend:1},K),thead:M,ul:Q,acronym:L,b:L,a:J,blockquote:P,caption:L,i:L,u:L,tbody:M,s:L,address:X(D,I),tt:L,legend:L,q:L,pre:X(G,C),p:L,em:L,dfn:L};})();FCKTools.GetEventTarget=function(e){var A=null;if (!e) var e=window.event;if (e.target) A=e.target;else if (e.srcElement) A=e.srcElement;if (A&&A.nodeType==3) A=A.parentNode;return A;};function _FCK_EditingArea_OnLoad(){FCK.EditorWindow=FCK.EditingArea.Window;FCK.EditorDocument=FCK.EditingArea.Document;if (FCKBrowserInfo.IsIE) FCKTempBin.ToElements();FCK.InitializeBehaviors();FCK.MouseDownFlag=false;FCKTools.AddEventListener(FCK.EditorDocument,'mousemove',_FCK_MouseEventsListener);FCKTools.AddEventListener(FCK.EditorDocument,'mousedown',_FCK_MouseEventsListener);FCKTools.AddEventListener(FCK.EditorDocument,'mouseup',_FCK_MouseEventsListener);if (FCKBrowserInfo.IsSafari){FCKTools.AddEventListener(FCK.EditorDocument,'paste',function(evt){var A=new FCKDomRange(FCK.EditorWindow);A.MoveToSelection();A.DeleteContents();var B=FCKSelection.GetSelectedElement()||FCKSelection.GetParentElement();var C=A.CreateBookmark(true);var D=FCK.EditorDocument.createElement('div');D.id='_fck_pastebin';D.className='fck_pastebin';D.innerHTML='\xa0';FCKDomTools.SetElementStyles(D,{position:'absolute',left:'-1000px',width:'1px',height:'1px',overflow:'hidden'});if (B){FCKDomTools.SetElementStyles(D,{top:FCKTools.GetDocumentPosition(FCK.EditorWindow,B).y+'px'});};FCK.EditorDocument.body.appendChild(D);A.SetStart(D,1);A.SetEnd(D,2);A.Select();setTimeout(function(){var E='',$bins=MindTouchDeki.$(FCK.EditorDocument).find('div.fck_pastebin'),br=FCK.EditorDocument.createElement('br');$bins.each(function(index){var $bin=MindTouchDeki.$(this);if ($bins.length>1&&index==0){return;};$bin.find('span.Apple-style-span').each(function(){FCKDomTools.RemoveNode(this,true);});$bin.children('meta').remove();E+=$bin.html();if (index<$bins.length-1){E+=br.outerHTML;}});FCKDomTools.RemoveNode(D);A.SelectBookmark(C);FCK.InsertHtml(E);},0);});};FCK.EnterKeyHandler=new FCKEnterKey(FCK.EditorWindow,FCKConfig.EnterMode,FCKConfig.ShiftEnterMode,FCKConfig.TabSpaces);FCK.KeystrokeHandler.AttachToElement(FCK.EditorDocument);if (FCK._ForceResetIsDirty) FCK.ResetIsDirty();if (FCKBrowserInfo.IsIE&&FCK.HasFocus) FCK.EditorDocument.body.setActive();FCK.OnAfterSetHTML();FCKCommands.GetCommand('ShowBlocks').RestoreState();if (FCK.Status!=FCK_STATUS_NOTLOADED) return;FCK.SetStatus(FCK_STATUS_ACTIVE);};if (!FCKBrowserInfo.IsIE){FCK.InsertHtml=function(A){var B=FCK.EditorDocument,range;A=FCKConfig.ProtectedSource.Protect(A);A=FCK.ProtectEvents(A);A=FCK.ProtectUrls(A);A=FCK.ProtectTags(A);FCKUndo.SaveUndoStep();if (FCKBrowserInfo.IsGecko||FCKBrowserInfo.IsSafari){A=A.replace(/&nbsp;$/,'$&<span _fcktemp="1"/>');var C=new FCKDocumentFragment(this.EditorDocument);C.AppendHtml(A);var D=C.RootNode.lastChild;range=new FCKDomRange(this.EditorWindow);range.MoveToSelection();var E=C.RootNode.firstChild;while (E&&E.nodeType!=1) E=E.nextSibling;if (E&&FCKListsLib.BlockElements[E.nodeName.toLowerCase()]) range.SplitBlock();range.DeleteContents();range.InsertNode(C.RootNode);range.MoveToPosition(D,4);}else B.execCommand('inserthtml',false,A);this.Focus();if (!range){range=new FCKDomRange(this.EditorWindow);range.MoveToSelection();};var F=range.CreateBookmark();FCKDocumentProcessor.Process(B);try{range.MoveToBookmark(F);range.Select();}catch (e) {};this.Events.FireEvent("OnSelectionChange");}};function FCKContextMenu_AttachedElement_OnContextMenu(A,B,C){if ((B.CtrlDisable&&(A.ctrlKey||A.metaKey))||FCKConfig.BrowserContextMenu) return true;var D=C||this;if (B.OnBeforeOpen) B.OnBeforeOpen.call(B,D);if (B._MenuBlock.Count()==0) return false;if (B._Redraw){B._MenuBlock.Create(B._Panel.MainNode);B._Redraw=false;};FCKTools.DisableSelection(B._Panel.Document.body);var x=0;var y=0;if (FCKBrowserInfo.IsIE){x=A.screenX;y=A.screenY;}else if (FCKBrowserInfo.IsSafari){x=A.clientX;y=A.clientY;}else{x=A.pageX;y=A.pageY;if (FCKBrowserInfo.IsOpera&&A.target){var E=FCKTools.GetElementDocument(A.target);if (E) y+=E.body.scrollTop;}};B._Panel.Show(x,y,A.currentTarget||null);return false;};
var FCKStyle=function(A){this.Element=(A.Element||'span').toLowerCase();this._StyleDesc=A;};FCKStyle.prototype={GetType:function(){var A=this.GetType_$;if (A!=undefined) return A;var B=this.Element;if (B=='#'||FCKListsLib.StyleBlockElements[B]) A=FCK_STYLE_BLOCK;else if (FCKListsLib.StyleObjectElements[B]) A=FCK_STYLE_OBJECT;else A=FCK_STYLE_INLINE;return (this.GetType_$=A);},ApplyToSelection:function(A){var B=new FCKDomRange(A);B.MoveToSelection();if (MindTouchDeki.CheckTable()){this._ToTable(B,this.ApplyToRange);}else{this.ApplyToRange(B,true);}},ApplyToRange:function(A,B,C){switch (this.GetType()){case FCK_STYLE_BLOCK:this.ApplyToRange=this._ApplyBlockStyle;break;case FCK_STYLE_INLINE:this.ApplyToRange=this._ApplyInlineStyle;break;default:return;};this.ApplyToRange(A,B,C);},ApplyToObject:function(A){if (!A) return;this.BuildElement(null,A);},RemoveFromSelection:function(A){var B=new FCKDomRange(A);B.MoveToSelection();if (MindTouchDeki.CheckTable()){this._ToTable(B,this.RemoveFromRange);}else{this.RemoveFromRange(B,true);}},RemoveFromRange:function(A,B,C){var D;var E=this._GetAttribsForComparison();var F=this._GetOverridesForComparison();if (A.CheckIsCollapsed()){var D=A.CreateBookmark(true);var H=A.GetBookmarkNode(D,true);var I=new FCKElementPath(H.parentNode);var J=[];var K=!FCKDomTools.GetNextSibling(H);var L=K||!FCKDomTools.GetPreviousSibling(H);var M;var N=-1;for (var i=0;i<I.Elements.length;i++){var O=I.Elements[i];if (this.CheckElementRemovable(O)){if (L&&!FCKDomTools.CheckIsEmptyElement(O,function(el){return (el!=H);})){M=O;N=J.length-1;}else{var P=O.nodeName.toLowerCase();if (P==this.Element){for (var Q in E){if (FCKDomTools.HasAttribute(O,Q)){switch (Q){case 'style':this._RemoveStylesFromElement(O);break;case '_fckstyle':break;case 'class':if (FCKDomTools.GetAttributeValue(O,Q)!=this.GetFinalAttributeValue(Q)) continue;default:FCKDomTools.RemoveAttribute(O,Q);}}}};this._RemoveOverrides(O,F[P]);if (this.GetType()==FCK_STYLE_INLINE) this._RemoveNoAttribElement(O);}}else if (L) J.push(O);L=L&&((K&&!FCKDomTools.GetNextSibling(O))||(!K&&!FCKDomTools.GetPreviousSibling(O)));if (M&&(!L||(i==I.Elements.length-1))){var R=FCKDomTools.RemoveNode(H);for (var j=0;j<=N;j++){var S=FCKDomTools.CloneElement(J[j]);S.appendChild(R);R=S;};if (K) FCKDomTools.InsertAfterNode(M,R);else M.parentNode.insertBefore(R,M);L=false;M=null;}};if (B) A.SelectBookmark(D);if (C) A.MoveToBookmark(D);return;};A.Expand('inline_elements');D=A.CreateBookmark(true);var T=A.GetBookmarkNode(D,true);var U=A.GetBookmarkNode(D,false);A.Release(true);var I=new FCKElementPath(T);var X=I.Elements;var O;var Z=null;if (this.GetType()!=FCK_STYLE_INLINE) Z=I.Block;for (var i=1;i<X.length;i++){O=X[i];if (O==I.Block||O==I.BlockLimit) break;if (this.CheckElementRemovable(O)) FCKDomTools.BreakParent(T,O,A);};I=new FCKElementPath(U);X=I.Elements;for (var i=1;i<X.length;i++){O=X[i];if (O==I.Block||O==I.BlockLimit) break;d=O.nodeName.toLowerCase();if (this.CheckElementRemovable(O)) FCKDomTools.BreakParent(U,O,A);};if (Z&&Z.nodeName.toLowerCase()==this.Element){var a=Z;}else{var a=FCKDomTools.GetNextSourceNode(T,true);}while (a){var c=FCKDomTools.GetNextSourceNode(a);if (a.nodeType==1){var d=a.nodeName.toLowerCase();var e=(d==this.Element);if (e){for (var Q in E){if (FCKDomTools.HasAttribute(a,Q)){switch (Q){case 'style':this._RemoveStylesFromElement(a);break;case '_fckstyle':break;case 'class':if (FCKDomTools.GetAttributeValue(a,Q)!=this.GetFinalAttributeValue(Q)) continue;default:FCKDomTools.RemoveAttribute(a,Q);}}}}else e=!!F[d];if (e){this._RemoveOverrides(a,F[d]);if (this.GetType()==FCK_STYLE_INLINE) this._RemoveNoAttribElement(a);}};if (c==U) break;a=c;};this._FixBookmarkStart(T);if (B) A.SelectBookmark(D);if (C) A.MoveToBookmark(D);},CheckElementRemovable:function(A,B){if (!A) return false;var C=A.nodeName.toLowerCase();if (C==this.Element){if (!B&&!FCKDomTools.HasAttributes(A)) return true;var D=this._GetAttribsForComparison();var E=(D._length==0);for (var F in D){if (F=='_length'||F=='_fckstyle') continue;if (this._CompareAttributeValues(F,FCKDomTools.GetAttributeValue(A,F),(this.GetFinalAttributeValue(F)||''))){E=true;if (!B) break;}else{E=false;if (B) return false;}};if (E) return true;};var G=this._GetOverridesForComparison()[C];if (G){if (!(D=G.Attributes)) return true;for (var i=0;i<D.length;i++){var H=D[i][0];if (FCKDomTools.HasAttribute(A,H)){var I=D[i][1];if (I==null||(typeof I=='string'&&FCKDomTools.GetAttributeValue(A,H)==I)||I.test(FCKDomTools.GetAttributeValue(A,H))) return true;}}};return false;},CheckActive:function(A){switch (this.GetType()){case FCK_STYLE_BLOCK:return this.CheckElementRemovable(A.Block||A.BlockLimit,true);case FCK_STYLE_INLINE:var B=A.Elements;for (var i=0;i<B.length;i++){var C=B[i];if (C==A.Block||C==A.BlockLimit) continue;if (this.CheckElementRemovable(C,true)) return true;}};return false;},RemoveFromElement:function(A){var B=this._GetAttribsForComparison();var C=this._GetOverridesForComparison();var D=A.getElementsByTagName(this.Element);for (var i=D.length-1;i>=0;i--){var E=D[i];for (var F in B){if (FCKDomTools.HasAttribute(E,F)){switch (F){case 'style':this._RemoveStylesFromElement(E);break;case '_fckstyle':break;case 'class':if (FCKDomTools.GetAttributeValue(E,F)!=this.GetFinalAttributeValue(F)) continue;default:FCKDomTools.RemoveAttribute(E,F);}}};this._RemoveOverrides(E,C[this.Element]);this._RemoveNoAttribElement(E);};for (var G in C){if (G!=this.Element){D=A.getElementsByTagName(G);for (var i=D.length-1;i>=0;i--){var E=D[i];this._RemoveOverrides(E,C[G]);this._RemoveNoAttribElement(E);}}}},_RemoveStylesFromElement:function(A){var B=A.getAttribute('_fckstyle')||A.style.cssText;var C=this.GetFinalStyleValue();if (B.length>0&&C.length==0) return;C='(^|;)\\s*('+C.replace(/\s*([^ ]+):.*?(;|$)/g,'$1|').replace(/\|$/,'')+'):[^;]+';var D=new RegExp(C,'gi');B=B.replace(D,'').Trim();if (B.length==0||B==';'){FCKDomTools.RemoveAttribute(A,'style');FCKDomTools.RemoveAttribute(A,'_fckstyle');}else{B=B.replace(D,'');A.style.cssText=B;A.setAttribute('_fckstyle',B);}},_RemoveOverrides:function(A,B){var C=B&&B.Attributes;if (C){for (var i=0;i<C.length;i++){var D=C[i][0];if (FCKDomTools.HasAttribute(A,D)){var E=C[i][1];if (E==null||(E.test&&E.test(FCKDomTools.GetAttributeValue(A,D)))||(typeof E=='string'&&FCKDomTools.GetAttributeValue(A,D)==E)) FCKDomTools.RemoveAttribute(A,D);}}}},_RemoveNoAttribElement:function(A){if (!FCKDomTools.HasAttributes(A)){var B=A.firstChild;var C=A.lastChild;FCKDomTools.RemoveNode(A,true);this._MergeSiblings(B);if (B!=C) this._MergeSiblings(C);}},BuildElement:function(A,B){var C=B||A.createElement(this.Element);var D=this._StyleDesc.Attributes;var E;if (D){for (var F in D){E=this.GetFinalAttributeValue(F);if (F.toLowerCase()=='class') C.className=E;else C.setAttribute(F,E);}};if (this._GetStyleText().length>0){var G=this.GetFinalStyleValue();C.style.cssText=G;C.setAttribute('_fckstyle',G);};return C;},_CompareAttributeValues:function(A,B,C){if ((A=='style'||A=='_fckstyle')&&B&&C){B=B.replace(/;$/,'').toLowerCase();C=C.replace(/;$/,'').toLowerCase();};return (B==C||((B===null||B==='')&&(C===null||C==='')))},GetFinalAttributeValue:function(A){var B=this._StyleDesc.Attributes;var B=B?B[A]:null;if (!B&&A=='style') return this.GetFinalStyleValue();if (B&&this._Variables) B=B.Replace(FCKRegexLib.StyleVariableAttName,this._GetVariableReplace,this);return B;},GetFinalStyleValue:function(){var A=this._GetStyleText();if (A.length>0&&this._Variables){A=A.Replace(FCKRegexLib.StyleVariableAttName,this._GetVariableReplace,this);A=FCKTools.NormalizeCssText(A);};return A;},_GetVariableReplace:function(){return this._Variables[arguments[2]]||arguments[0];},SetVariable:function(A,B){var C=this._Variables;if (!C) C=this._Variables={};this._Variables[A]=B;},_FromPre:function(A,B,C){var D=B.innerHTML;D=D.replace(/(\r\n|\r)/g,'\n');D=D.replace(/^[ \t]*\n/,'');D=D.replace(/\n$/,'');D=D.replace(/^[ \t]+|[ \t]+$/g,function(match,offset,s){if (match.length==1) return '&nbsp;';else if (offset==0) return new Array(match.length).join('&nbsp;')+' ';else return ' '+new Array(match.length).join('&nbsp;');});var E=new FCKHtmlIterator(D);var F=[];E.Each(function(isTag,value){if (!isTag){value=value.replace(/\n/g,'<br>');value=value.replace(/[ \t]{2,}/g,function (match){return new Array(match.length).join('&nbsp;')+' ';});};F.push(value);});C.innerHTML=F.join('');return C;},_ToPre:function(A,B,C){var D=B.innerHTML.Trim();D=D.replace(/[ \t\r\n]*(<br[^>]*>)[ \t\r\n]*/gi,'<br />');var E=new FCKHtmlIterator(D);var F=[];E.Each(function(isTag,value){if (!isTag) value=value.replace(/([ \t\n\r]+|&nbsp;)/g,' ');else if (isTag&&value=='<br />') value='\n';F.push(value);});if (FCKBrowserInfo.IsIE){var G=A.createElement('div');G.appendChild(C);C.outerHTML='<pre>\n'+F.join('')+'</pre>';C=G.removeChild(G.firstChild);}else C.innerHTML=F.join('');return C;},_ToTable:function(A,B){var C=FCKTableHandler.GetSelectedCells();for (var i=0;i<C.length;i++){var D=C[i];var E=A.Clone();E.SetStart(D,1);E.SetEnd(D,2);B.apply(this,[E,false,true]);}},_CheckAndMergePre:function(A,B){if (A!=FCKDomTools.GetPreviousSourceElement(B,true)) return;var C=A.innerHTML.replace(/\n$/,'')+'\n\n'+B.innerHTML.replace(/^\n/,'');if (FCKBrowserInfo.IsIE) B.outerHTML='<pre>'+C+'</pre>';else B.innerHTML=C;FCKDomTools.RemoveNode(A);},_CheckAndSplitPre:function(A){var B;var C=A.firstChild;C=C&&C.nextSibling;while (C){var D=C.nextSibling;if (D&&D.nextSibling&&C.nodeName.IEquals('br')&&D.nodeName.IEquals('br')){FCKDomTools.RemoveNode(C);C=D.nextSibling;FCKDomTools.RemoveNode(D);B=FCKDomTools.InsertAfterNode(B||A,FCKDomTools.CloneElement(A));continue;};if (B){C=C.previousSibling;FCKDomTools.MoveNode(C.nextSibling,B);};C=C.nextSibling;}},_ApplyBlockStyle:function(A,B,C){var D;if (B) D=A.CreateBookmark();var E=new FCKDomRangeIterator(A);E.EnforceRealBlocks=true;var F;var G=A.Window.document;var H;while((F=E.GetNextParagraph())){var I=this.BuildElement(G);var J=I.nodeName.IEquals('pre');var K=F.nodeName.IEquals('pre');var L=J&&!K;var M=!J&&K;if (L) I=this._ToPre(G,F,I);else if (M) I=this._FromPre(G,F,I);else FCKDomTools.MoveChildren(F,I);F.parentNode.insertBefore(I,F);FCKDomTools.RemoveNode(F);if (J){if (H) this._CheckAndMergePre(H,I);H=I;}else if (M) this._CheckAndSplitPre(I);};if (B) A.SelectBookmark(D);if (C) A.MoveToBookmark(D);},_ApplyInlineStyle:function(A,B,C){var D=A.Window.document;if (A.CheckIsCollapsed()){var E=this.BuildElement(D);A.InsertNode(E);A.MoveToPosition(E,2);A.Select();return;};var F=this.Element;var G=FCK.DTD[F]||FCK.DTD.span;var H=this._GetAttribsForComparison();var I;A.Expand('inline_elements');var J=A.CreateBookmark(true);var K=A.GetBookmarkNode(J,true);var L=A.GetBookmarkNode(J,false);A.Release(true);var M=FCKDomTools.GetNextSourceNode(K,true);while (M){var N=false;var O=M.nodeType;var P=O==1?M.nodeName.toLowerCase():null;if (!P||(G[P]&&(FCKDomTools.ComparePosition(M,L)|FCK_POSITION_FOLLOWING|FCK_POSITION_IDENTICAL|FCK_POSITION_CONTAINS)==(FCK_POSITION_FOLLOWING+FCK_POSITION_IDENTICAL+FCK_POSITION_CONTAINS))){if ((FCK.DTD[M.parentNode.nodeName.toLowerCase()]||FCK.DTD.span)[F]||!FCK.DTD[F]){if (!A.CheckHasRange()&&(!P||!FCKListsLib.RemoveEmpty[P]||(FCKDomTools.ComparePosition(M,L)|FCK_POSITION_FOLLOWING|FCK_POSITION_IDENTICAL|FCK_POSITION_CONTAINS)==(FCK_POSITION_FOLLOWING+FCK_POSITION_IDENTICAL+FCK_POSITION_CONTAINS))) A.SetStart(M,3);if (O!=1||M.childNodes.length==0){var Q=M;var R=Q.parentNode;while (Q==R.lastChild&&G[R.nodeName.toLowerCase()]){Q=R;};A.SetEnd(Q,4);if (Q==Q.parentNode.lastChild&&!G[Q.parentNode.nodeName.toLowerCase()]) N=true;}else{A.SetEnd(M,3);}}else N=true;}else N=true;M=FCKDomTools.GetNextSourceNode(M);if (M==L){M=null;N=true;};if (N&&A.CheckHasRange()&&!A.CheckIsCollapsed()){I=this.BuildElement(D);A.ExtractContents().AppendTo(I);if (I.innerHTML.RTrim().length>0){A.InsertNode(I);this.RemoveFromElement(I);this._MergeSiblings(I,this._GetAttribsForComparison());if (!FCKBrowserInfo.IsIE) I.normalize();};A.Release(true);}};this._FixBookmarkStart(K);if (B) A.SelectBookmark(J);if (C) A.MoveToBookmark(J);},_FixBookmarkStart:function(A){var B;while ((B=A.nextSibling)){if (B.nodeType==1&&FCKListsLib.InlineNonEmptyElements[B.nodeName.toLowerCase()]){if (!B.firstChild) FCKDomTools.RemoveNode(B);else FCKDomTools.MoveNode(A,B,true);continue;};if (B.nodeType==3&&B.length==0){FCKDomTools.RemoveNode(B);continue;};break;}},_MergeSiblings:function(A,B){if (!A||A.nodeType!=1||!FCKListsLib.InlineNonEmptyElements[A.nodeName.toLowerCase()]) return;this._MergeNextSibling(A,B);this._MergePreviousSibling(A,B);},_MergeNextSibling:function(A,B){var C=A.nextSibling;var D=(C&&C.nodeType==1&&C.getAttribute('_fck_bookmark'));if (D) C=C.nextSibling;if (C&&C.nodeType==1&&C.nodeName==A.nodeName){if (!B) B=this._CreateElementAttribsForComparison(A);if (this._CheckAttributesMatch(C,B)){var E=A.lastChild;if (D) FCKDomTools.MoveNode(A.nextSibling,A);FCKDomTools.MoveChildren(C,A);FCKDomTools.RemoveNode(C);if (E) this._MergeNextSibling(E);}}},_MergePreviousSibling:function(A,B){var C=A.previousSibling;var D=(C&&C.nodeType==1&&C.getAttribute('_fck_bookmark'));if (D) C=C.previousSibling;if (C&&C.nodeType==1&&C.nodeName==A.nodeName){if (!B) B=this._CreateElementAttribsForComparison(A);if (this._CheckAttributesMatch(C,B)){var E=A.firstChild;if (D) FCKDomTools.MoveNode(A.previousSibling,A,true);FCKDomTools.MoveChildren(C,A,true);FCKDomTools.RemoveNode(C);if (E) this._MergePreviousSibling(E);}}},_GetStyleText:function(){var A=this._StyleDesc.Styles;var B=(this._StyleDesc.Attributes?this._StyleDesc.Attributes['style']||'':'');if (B.length>0) B+=';';for (var C in A) B+=C+':'+A[C]+';';if (B.length>0&&!(/#\(/.test(B))){B=FCKTools.NormalizeCssText(B);};return (this._GetStyleText=function() { return B;})();},_GetAttribsForComparison:function(){var A=this._GetAttribsForComparison_$;if (A) return A;A={};var B=this._StyleDesc.Attributes;if (B){for (var C in B){A[C.toLowerCase()]=B[C].toLowerCase();}};if (this._GetStyleText().length>0){A['style']=this._GetStyleText().toLowerCase();A['_fckstyle']=A['style'];};FCKTools.AppendLengthProperty(A,'_length');return (this._GetAttribsForComparison_$=A);},_GetOverridesForComparison:function(){var A=this._GetOverridesForComparison_$;if (A) return A;A={};var B=this._StyleDesc.Overrides;if (B){if (!FCKTools.IsArray(B)) B=[B];for (var i=0;i<B.length;i++){var C=B[i];var D;var E;var F;if (typeof C=='string') D=C.toLowerCase();else{D=C.Element?C.Element.toLowerCase():this.Element;F=C.Attributes;};E=A[D]||(A[D]={});if (F){var G=(E.Attributes=E.Attributes||[]);for (var H in F){G.push([H.toLowerCase(),F[H]]);}}}};return (this._GetOverridesForComparison_$=A);},_CreateElementAttribsForComparison:function(A){var B={};var C=0;for (var i=0;i<A.attributes.length;i++){var D=A.attributes[i];if (D.specified){B[D.nodeName.toLowerCase()]=FCKDomTools.GetAttributeValue(A,D).toLowerCase();C++;}};B._length=C;return B;},_CheckAttributesMatch:function(A,B){var C=A.attributes;var D=0;for (var i=0;i<C.length;i++){var E=C[i];if (E.specified){var F=E.nodeName.toLowerCase();var G=B[F];if (!G) break;if (G!=FCKDomTools.GetAttributeValue(A,E).toLowerCase()) break;D++;}};return (D==B._length);}};
var FCKEnterKey=function(A,B,C,D){this.Window=A;this.EnterMode=B||'p';this.ShiftEnterMode=C||'br';var E=new FCKKeystrokeHandler(false);E._EnterKey=this;E.OnKeystroke=FCKEnterKey_OnKeystroke;E.SetKeystrokes([[13,'Enter'],[SHIFT+13,'ShiftEnter'],[8,'Backspace'],[CTRL+8,'CtrlBackspace'],[46,'Delete']]);this.TabText='';if (D>0||FCKBrowserInfo.IsSafari){while (D--) this.TabText+='\xa0';E.SetKeystrokes([9,'Tab']);};E.AttachToElement(A.document);};function FCKEnterKey_OnKeystroke(A,B){var C=this._EnterKey;try{switch (B){case 'Enter':return C.DoEnter();break;case 'ShiftEnter':return C.DoShiftEnter();break;case 'Backspace':return C.DoBackspace();break;case 'Delete':return C.DoDelete();break;case 'Tab':return C.DoTab();break;case 'CtrlBackspace':return C.DoCtrlBackspace();break;}}catch (e){};return false;};FCKEnterKey.prototype.DoEnter=function(A,B){if (typeof(this._AutoReplace)=='function') this._AutoReplace();FCKUndo.SaveUndoStep();this._HasShift=(B===true);var C=FCKSelection.GetParentElement();var D=new FCKElementPath(C);var E=A||this.EnterMode;if (E=='br'||D.Block&&D.Block.tagName.toLowerCase()=='pre') return this._ExecuteEnterBr();else return this._ExecuteEnterBlock(E);};FCKEnterKey.prototype._AutoReplace=function(){if (typeof(FindReplace)=='undefined') return false;var A=FCKSelection.GetBoundaryParentElement(true);var B=new FCKElementPath(A);var C=B.Block;if (C&&!(C.nodeName.toLowerCase()=='pre')){var D=FCK.EditorDocument.createElement('a');D.className='internal';D.title='User:'+FCKConfig.UserName;D.href=MindTouchDeki.InternalPrefix+'User:'+FCKConfig.UserName;D.innerHTML=FCKConfig.UserName;var E=new FCKDomRange(this.Window);E.MoveToSelection();var F=E.CreateBookmark();var G=new FindReplace();G.ReplaceAll(C,'~~~~',[D,FCK.EditorDocument.createTextNode(' '+FCKConfig.Today)],false,true,false);var G=new FindReplace();G.ReplaceAll(C,'~~~',[D],false,true,false);E.MoveToBookmark(F);E.Select();return true;};return false;};FCKEnterKey.prototype.DoShiftEnter=function(){return this.DoEnter(this.ShiftEnterMode,true);};FCKEnterKey.prototype.DoBackspace=function(){var A=false;var B=new FCKDomRange(this.Window);B.MoveToSelection();if (FCKBrowserInfo.IsIE&&this._CheckIsAllContentsIncluded(B,this.Window.document.body)){this._FixIESelectAllBug(B);return true;};var C=B.CheckIsCollapsed();if (!C){if (FCKBrowserInfo.IsIE&&this.Window.document.selection.type.toLowerCase()=="control"){var D=this.Window.document.selection.createRange();for (var i=D.length-1;i>=0;i--){var E=D.item(i);E.parentNode.removeChild(E);};return true;};return false;};if (FCKBrowserInfo.IsIE){var F=FCKDomTools.GetPreviousSourceElement(B.StartNode,true);if (F&&F.nodeName.toLowerCase()=='br'){var G=B.Clone();G.SetStart(F,4);if (G.CheckIsEmpty()){F.parentNode.removeChild(F);return true;}}};var H=B.StartBlock;var I=B.EndBlock;if (B.StartBlockLimit==B.EndBlockLimit&&H&&I){if (!C){var J=B.CheckEndOfBlock();B.DeleteContents();if (H!=I){B.SetStart(I,1);B.SetEnd(I,1);};B.Select();A=(H==I);};if (B.CheckStartOfBlock()){var K=B.StartBlock;var L=FCKDomTools.GetPreviousSourceElement(K,true,['BODY',B.StartBlockLimit.nodeName],['UL','OL']);A=this._ExecuteBackspace(B,L,K);}else if (FCKBrowserInfo.IsGeckoLike){B.Select();}};B.Release();return A;};FCKEnterKey.prototype.DoCtrlBackspace=function(){FCKUndo.SaveUndoStep();var A=new FCKDomRange(this.Window);A.MoveToSelection();if (FCKBrowserInfo.IsIE&&this._CheckIsAllContentsIncluded(A,this.Window.document.body)){this._FixIESelectAllBug(A);return true;};return false;};FCKEnterKey.prototype._ExecuteBackspace=function(A,B,C){var D=false;if (!B&&C&&C.nodeName.IEquals('LI')&&C.parentNode.parentNode.nodeName.IEquals('LI')){this._OutdentWithSelection(C,A);return true;};if (B&&B.nodeName.IEquals('LI')){var E=FCKDomTools.GetLastChild(B,['UL','OL']);while (E){B=FCKDomTools.GetLastChild(E,'LI');E=FCKDomTools.GetLastChild(B,['UL','OL']);}};if (B&&C){if (C.nodeName.IEquals('LI')&&!B.nodeName.IEquals('LI')){this._OutdentWithSelection(C,A);return true;};var F=C.parentNode;var G=B.nodeName.toLowerCase();if (FCKListsLib.EmptyElements[G]!=null||G=='table'){if (G!='table'){FCKDomTools.RemoveNode(B);};D=true;}else{FCKDomTools.RemoveNode(C);while (F.innerHTML.Trim().length==0){var H=F.parentNode;H.removeChild(F);F=H;};FCKDomTools.LTrimNode(C);FCKDomTools.RTrimNode(B);A.SetStart(B,2,true);A.Collapse(true);var I=A.CreateBookmark(true);if (!C.tagName.IEquals(['TABLE'])) FCKDomTools.MoveChildren(C,B);A.SelectBookmark(I);D=true;}};return D;};FCKEnterKey.prototype.DoDelete=function(){FCKUndo.SaveUndoStep();var A=false;var B=new FCKDomRange(this.Window);B.MoveToSelection();if (FCKBrowserInfo.IsIE&&this._CheckIsAllContentsIncluded(B,this.Window.document.body)){this._FixIESelectAllBug(B);return true;};if (B.CheckIsCollapsed()&&B.CheckEndOfBlock(FCKBrowserInfo.IsGeckoLike)){var C=B.StartBlock;var D=FCKTools.GetElementAscensor(C,'td');var E=FCKDomTools.GetNextSourceElement(C,true,[B.StartBlockLimit.nodeName],['UL','OL','TR'],true);if (D){var F=FCKTools.GetElementAscensor(E,'td');if (F!=D) return true;};A=this._ExecuteBackspace(B,C,E);};B.Release();return A;};FCKEnterKey.prototype.DoTab=function(){var A=new FCKDomRange(this.Window);A.MoveToSelection();var B=A._Range.startContainer;while (B){if (B.nodeType==1){var C=B.tagName.toLowerCase();if (C=="tr"||C=="td"||C=="th"||C=="tbody"||C=="table") return false;else break;};B=B.parentNode;};if (this.TabText){A.DeleteContents();A.InsertNode(this.Window.document.createTextNode(this.TabText));A.Collapse(false);A.Select();};return true;};FCKEnterKey.prototype._ExecuteEnterBlock=function(A,B){var C=B||new FCKDomRange(this.Window);var D=C.SplitBlock(A);if (D){var E=D.PreviousBlock;var F=D.NextBlock;var G=D.WasStartOfBlock;var H=D.WasEndOfBlock;if (F){if (F.parentNode.nodeName.IEquals('li')){FCKDomTools.BreakParent(F,F.parentNode);FCKDomTools.MoveNode(F,F.nextSibling,true);}}else if (E&&E.parentNode.nodeName.IEquals('li')){FCKDomTools.BreakParent(E,E.parentNode);C.MoveToElementEditStart(E.nextSibling);FCKDomTools.MoveNode(E,E.previousSibling);};if (!G&&!H){if (F.nodeName.IEquals('li')&&F.firstChild&&F.firstChild.nodeName.IEquals(['ul','ol'])) F.insertBefore(FCKTools.GetElementDocument(F).createTextNode('\xa0'),F.firstChild);if (F) C.MoveToElementEditStart(F);}else{if (G&&H){switch (E.tagName.toUpperCase()){case 'LI':C.MoveToElementStart(E);this._OutdentWithSelection(E,C);C.Release();return true;case 'DT':var I=oDocument.createElement(FCKConfig.EnterMode=='p'?'p':'div');FCKDomTools.MoveChildren(E.parentNode.removeChild(E),I);FCKDomTools.InsertAfterNode(E.parentNode,I);return true;}};var J;if (E){var K=E.tagName.toUpperCase();if (K.Equals(['DT','DD'])){J=this.Window.document.createElement(K=='DT'?'DD':'DT');}else if (!this._HasShift&&!(/^H[1-6]$/).test(K)){J=FCKDomTools.CloneElement(E);}}else if (F){if (F.tagName.toUpperCase()=='DD'){J=this.Window.document.createElement('DT');}else J=FCKDomTools.CloneElement(F);};if (!J) J=this.Window.document.createElement(A);var L=D.ElementPath;if (L){for (var i=0,len=L.Elements.length;i<len;i++){var M=L.Elements[i];if (M==L.Block||M==L.BlockLimit) break;if (FCKListsLib.InlineChildReqElements[M.nodeName.toLowerCase()]){M=FCKDomTools.CloneElement(M);FCKDomTools.MoveChildren(J,M);J.appendChild(M);}}};if (FCKBrowserInfo.IsGeckoLike) FCKTools.AppendBogusBr(J);C.InsertNode(J);if (FCKBrowserInfo.IsIE){C.MoveToElementEditStart(J);C.Select();};C.MoveToElementEditStart(G&&!H?F:J);};if (FCKBrowserInfo.IsGeckoLike){if (F){var N=this.Window.document.createElement('span');N.innerHTML='&nbsp;';C.InsertNode(N);FCKDomTools.ScrollIntoView(N,false);C.DeleteContents();}else{FCKDomTools.ScrollIntoView(F||J,false);}};C.Select();};C.Release();return true;};FCKEnterKey.prototype._ExecuteEnterBr=function(A){var B=new FCKDomRange(this.Window);B.MoveToSelection();if (B.StartBlockLimit==B.EndBlockLimit){B.DeleteContents();B.MoveToSelection();var C=B.CheckStartOfBlock();var D=B.CheckEndOfBlock();var E=B.StartBlock?B.StartBlock.tagName.toUpperCase():'';var F=this._HasShift;var G=E.IEquals('pre');if (!F&&E=='LI') return this._ExecuteEnterBlock(null,B);if ((!F&&D&&(/^H[1-6]$/).test(E))||(F&&G&&FCKConfig.EnterMode=='br')){G=false;FCKDomTools.InsertAfterNode(B.StartBlock,this.Window.document.createElement('br'));if (FCKBrowserInfo.IsGecko) FCKDomTools.InsertAfterNode(B.StartBlock,this.Window.document.createTextNode(''));B.SetStart(B.StartBlock.nextSibling,FCKBrowserInfo.IsIE?3:1);}else if (F&&G){G=false;this._ExecuteEnterBlock(FCKConfig.EnterMode,B);}else if (FCKBrowserInfo.IsGecko&&G){B.Collapse(true);B.Select(G);B.Release();return false;}else{var H;if (G) H=this.Window.document.createTextNode(FCKBrowserInfo.IsIE?'\r':'\n');else H=this.Window.document.createElement('br');B.InsertNode(H);if (FCKBrowserInfo.IsGecko) FCKDomTools.InsertAfterNode(H,this.Window.document.createTextNode(''));if (D&&FCKBrowserInfo.IsGeckoLike) FCKTools.AppendBogusBr(H.parentNode);if (FCKBrowserInfo.IsIE) B.SetStart(H,4);else B.SetStart(H.nextSibling,1);if (!FCKBrowserInfo.IsIE){var I=null;if (FCKBrowserInfo.IsOpera) I=this.Window.document.createElement('span');else I=this.Window.document.createElement('br');H.parentNode.insertBefore(I,H.nextSibling);FCKDomTools.ScrollIntoView(I,false);I.parentNode.removeChild(I);}};B.Collapse(true);B.Select(G);};B.Release();return true;};FCKEnterKey.prototype._OutdentWithSelection=function(A,B){var C=B.CreateBookmark();FCKListHandler.OutdentListItem(A);B.MoveToBookmark(C);B.Select();};FCKEnterKey.prototype._CheckIsAllContentsIncluded=function(A,B){var C=false;var D=false;if (A.StartContainer==B||A.StartContainer==B.firstChild) C=(A._Range.startOffset==0);if (A.EndContainer==B||A.EndContainer==B.lastChild){var E=A.EndContainer.nodeType==3?A.EndContainer.length:A.EndContainer.childNodes.length;D=(A._Range.endOffset==E);};return C&&D;};FCKEnterKey.prototype._FixIESelectAllBug=function(A){var B=this.Window.document;B.body.innerHTML='';var C;if (FCKConfig.EnterMode.IEquals(['div','p'])){C=B.createElement(FCKConfig.EnterMode);B.body.appendChild(C);}else C=B.body;A.MoveToNodeContents(C);A.Collapse(true);A.Select();A.Release();};
var MindTouchDekiKeysStrokes=function(A){this.Window=A;var B=new FCKKeystrokeHandler(false);B._MindTouchDekiKeysStrokes=this;B.OnKeystroke=MindTouchDekiKeysStrokes_OnKeystroke;B.SetKeystrokes([[CTRL+49/*1*/,'Header'],[CTRL+50/*2*/,'Header'],[CTRL+51/*3*/,'Header'],[CTRL+52/*4*/,'Header'],[CTRL+53/*5*/,'Header'],[CTRL+48/*0*/,'Paragraph'],[CTRL+78/*N*/,'Paragraph'],[CTRL+SHIFT+76/*L*/,'InsertList'],[9/*TAB*/,'Tab'],[CTRL+9/*TAB*/,'Tab'],[SHIFT+9/*TAB*/,'Tab']]);B.AttachToElement(A.document);};function MindTouchDekiKeysStrokes_OnKeystroke(A,B){var C=this._MindTouchDekiKeysStrokes;try{switch (B){case 'Header':var D='h'+(A-1047);return C.ApplyStyle(FCKStyles.GetStyle('_FCK_'+D));break;case 'Paragraph':return C.ApplyStyle(FCKStyles.GetStyle('_FCK_p'));break;case 'InsertList':return C.DoList();break;case 'Tab':return C.DoTab(A);break;}}catch (e){};return false;};MindTouchDekiKeysStrokes.prototype.ApplyStyle=function(A){FCKUndo.SaveUndoStep();FCK.Styles.ApplyStyle(A);FCK.Focus();FCK.Events.FireEvent('OnSelectionChange');return true;};MindTouchDekiKeysStrokes.prototype.DoList=function(){var A;if (FCK_TRISTATE_ON==FCKCommands.GetCommand('InsertUnorderedList').GetState()){A='InsertOrderedList';}else{if (FCK_TRISTATE_ON==FCKCommands.GetCommand('InsertOrderedList').GetState()){var B=FCKSelection.GetParentElement();var C=new FCKElementPath(B);var D=0;A='InsertOrderedList';for (var i=0;i<C.Elements.length;i++){var E=C.Elements[i];if (E.nodeName.IEquals(['ul','ol'])){D++;};if (D>1){A='InsertUnorderedList';break;}}}else{A='InsertUnorderedList';}};if (!(FCK_TRISTATE_DISABLED==FCKCommands.GetCommand(A).GetState())){FCKCommands.GetCommand(A).Execute();};return true;};MindTouchDekiKeysStrokes.prototype.DoTab=function(A){var B=(A==SHIFT+9);var C=(A==CTRL+9);var D=B?'Outdent':'Indent';var E=new FCKDomRange(this.Window);E.MoveToSelection();var F=false;var G=E._Range.startContainer;while (G){if (G.nodeType==1){var H=G.tagName.toLowerCase();if (H=="td"||H=="th"){if (F){var I=E.CheckStartOfBlock();if (I||(!I&&C)){break;}};var J=G;var K=B?MindTouchDeki.GetPreviousSibling(J,['TD','TH']):MindTouchDeki.GetNextSibling(J,['TD','TH']);if (K==null){var L=B?MindTouchDeki.GetPreviousSibling(J.parentNode,['TR']):MindTouchDeki.GetNextSibling(J.parentNode,['TR']);if (L){K=B?FCKDomTools.GetLastChild(L,['TD','TH']):FCKDomTools.GetFirstChild(L,['TD','TH']);}};if (K==null){if (B){break;};FCKUndo.SaveUndoStep();FCKTableHandler.InsertRow(false);var M=FCKSelection.MoveToAncestorNode('TR');if (M&&M.cells.length>0){var K=M.cells.item(0);}};if (K!=null){E.MoveToNodeContents(K);E.Collapse();E.Select();return true;}else{return false;}}else if (H=="tr"||H=="tbody"||H=="table"){return false;}else if (H=="dt"||(H=="dd"&&B)){FCKUndo.SaveUndoStep();var O=E.CreateBookmark();var P=(H=='dt')?'dd':'dt';MindTouchDeki.RenameNode(G,P);E.SelectBookmark(O);return true;}else if (H=='li'){F=true;}};G=G.parentNode;};if (E.StartBlock&&/^h[1-6]$/i.test(E.StartBlock.tagName)){var Q=FCKDomTools.GetNextSourceElement(E.StartBlock,false,null,['hr','br'],false);if (Q){E.MoveToNodeContents(Q);E.Collapse(true);E.Select();E.Release();};return true;};var R=FCKConfig.DekiTabSpaces;if (!E.CheckStartOfBlock()&&R>0){if (FCKConfig.TabSpaces>0||B){return true;};FCKUndo.SaveUndoStep();var S='';while (R-->0) S+='\xa0';E.DeleteContents();E.InsertNode(this.Window.document.createTextNode(S));E.Collapse(false);E.Select();return true;};if (!(FCK_TRISTATE_DISABLED==FCKCommands.GetCommand(D).GetState())){FCKCommands.GetCommand(D).Execute();};return true;};function MindTouchDekiKeysHandler_SetHandler(){if (FCK.EditMode!=FCK_EDITMODE_WYSIWYG) return;FCK.MindTouchDekiKeysHandler=new MindTouchDekiKeysStrokes(FCK.EditorWindow);};FCK.Events.AttachEvent('OnAfterSetHTML',MindTouchDekiKeysHandler_SetHandler);
var MindTouchDeki_Save=function(){};MindTouchDeki_Save.prototype.Execute=function(){var A=parent.Deki;if (A.Editor&&A.Editor.CheckPermissions){A.Editor.CheckPermissions(this.Save,this);}else{this.Save();}};MindTouchDeki_Save.prototype.Save=function(){if (FCKConfig.ReadOnly) return false;MindTouchDeki.ScrollToTop();if (FCKBrowserInfo.IsOpera){FCK.UpdateLinkedField();};FCK.Events.FireEvent('OnSave');FCK.GetParentForm().submit();};MindTouchDeki_Save.prototype.GetState=function(){if (FCKConfig.ReadOnly) return FCK_TRISTATE_DISABLED;return FCK_TRISTATE_OFF;};var MindTouchDeki_Cancel=function(){};MindTouchDeki_Cancel.prototype.Execute=function(){var A=FCKCommands.GetCommand('FitWindow');if (A.GetState()==FCK_TRISTATE_ON){A.Execute();};MindTouchDeki.ScrollToTop();FCK.Events.FireEvent('OnCancel');};MindTouchDeki_Cancel.prototype.GetState=function(){return FCK_TRISTATE_OFF;};FCKCommands.RegisterCommand('MindTouchDeki_Save',new MindTouchDeki_Save);FCKCommands.RegisterCommand('MindTouchDeki_Cancel',new MindTouchDeki_Cancel);var oSaveItem=new FCKToolbarButton('MindTouchDeki_Save',FCKLang.Save,null,FCK_TOOLBARITEM_ICONTEXT,true,true,FCKConfig.DekiCommonPath+"/icons/save_18.gif");FCKToolbarItems.RegisterItem('MindTouchDeki_Save',oSaveItem);var oCancelItem=new FCKToolbarButton('MindTouchDeki_Cancel',FCKLang.Cancel,null,FCK_TOOLBARITEM_ICONTEXT,true,true,[FCKConfig.DekiCommonPath+"/icons/icons.gif",16,101]);FCKToolbarItems.RegisterItem('MindTouchDeki_Cancel',oCancelItem);
var FCKInsertImageCommand=function() {};FCKInsertImageCommand.prototype={GetState:MindTouchDeki.GetState,Execute:function(){this._Image=FCK.Selection.GetSelectedElement();if (this._Image&&this._Image.tagName!='IMG'&&!(this._Image.tagName=='INPUT'&&this._Image.type=='image')) this._Image=null;var A={};if (this._Image){var B=parent.YAHOO.util.Dom;var C='';if (B.hasClass(this._Image,'rwrap')){C='right';}else if (B.hasClass(this._Image,'lwrap')){C='left';}else{C='default';};var D=parseInt(FCKDomTools.GetCurrentElementStyle(this._Image,'width'))||parseInt(this._Image.style.width)||FCKDomTools.GetAttributeValue(this._Image,'width')||0;var E=parseInt(FCKDomTools.GetCurrentElementStyle(this._Image,'height'))||parseInt(this._Image.style.height)||FCKDomTools.GetAttributeValue(this._Image,'height')||0;A={'bInternal':B.hasClass(this._Image,'internal'),'sSrc':this._Image.src,'sAlt':this._Image.alt,'sWrap':C,'nWidth':D,'nHeight':E};};A.nPageId=FCKConfig.PageId;A.sUserName=FCKConfig.UserName;var F=FCKConfig.DekiCommonPath+'/popups/image_dialog.php?contextID='+FCKConfig.PageId;if (this._Image){F+="&update=true";};MindTouchDeki.OpenDialog('InsertImage',F,"600px","370px",A,this._InsertImage);},_InsertImage:function(A){FCKUndo.SaveUndoStep();this._Image=FCK.InsertElement('img');try{this._Image.src=A.sSrc;this._Image.setAttribute('_fcksavedurl',A.sSrc);if (A.nWidth||A.nHeight){this._Image.style.width=A.nWidth+'px';this._Image.style.height=A.nHeight+'px';};if (A.sAlt){this._Image.alt=A.sAlt;};var B=(A.bInternal)?'internal ':'';this._Image.setAttribute('class',B+A.sWrapClass);switch (A.sWrap){case 'left':case 'right':this._Image.align=A.sWrap;break;default:if(this._Image.align){this._Image.removeAttribute('align',2);};break;};if (A.sFullSrc&&A.sFullSrc.length>0){var C=FCKTools.GetElementAscensor(this._Image,'A');if (!C) C=FCK.EditorDocument.createElement('a');C.href=A.sFullSrc;C.setAttribute('_fcksavedurl',A.sFullSrc);if (A.sAlt) C.setAttribute('title',A.sAlt);C=this._Image.parentNode.insertBefore(C,this._Image);FCKDomTools.MoveNode(this._Image,C,true);}}catch (e) {}}};FCKCommands.RegisterCommand('MindTouchDeki_InsertImage',new FCKInsertImageCommand);var oInsertImageItem=new FCKToolbarButton('MindTouchDeki_InsertImage',FCKLang.InsertImageLbl,FCKLang.InsertImage,null,false,true,37);FCKToolbarItems.RegisterItem('MindTouchDeki_InsertImage',oInsertImageItem);
var FCKAttachImageCommand=function() {};FCKAttachImageCommand.prototype={GetState:function(){if (parent.Deki&&parent.Deki.PageId==0) return FCK_TRISTATE_DISABLED;return MindTouchDeki.GetState();},Execute:function(){oParams={titleID:FCKConfig.PageId,commonPath:FCKConfig.DekiCommonPath};var A=parent.Deki.Dialog;var B=new A();B.setConfig({'src':FCKConfig.DekiCommonPath+'/popups/attach_dialog.php?filter=images','width':'650px','height':'auto','buttons':[A.BTN_OK,A.BTN_CANCEL],'args':oParams,'callback':this._InsertImage});B.render();B.show();},_InsertImage:function(A){FCKUndo.SaveUndoStep();var B=[];for (var i=0;i<A.length;i++){if (A[i]!==false){B.push(A[i]);}};var C={'fileIds':B.join(',')};MindTouchDeki.$.get('/deki/gui/attachments.php?action=getbyids',C,function(files) {var D=parent.YAHOO;if (D.lang.isArray(files)){for (var i=0;i<files.length;i++){var E=files[i];if (!D.lang.isObject(E)) continue;FCK.InsertElement('p');var F=null;if (E['width']&&E['height']){F=FCK.InsertElement('img');F.src=MindTouchDeki.StripHost(E['href']);F.style.width=E['width']+'px';F.style.height=E['height']+'px';F.alt='';}else{F=FCK.InsertElement('a');var G=MindTouchDeki.StripHost(E['href']);F.href=F.innerHTML=F.title=G;};MindTouchDeki.$(F).addClass('internal');};if (parent.Deki.Plugin&&parent.Deki.Plugin.FilesTable){parent.Deki.Plugin.FilesTable.Refresh(FCKConfig.PageId);};FCK.Events.FireEvent('OnSelectionChange');}},'json');}};FCKCommands.RegisterCommand('MindTouchDeki_AttachImage',new FCKAttachImageCommand);var oAttachImageItem=new FCKToolbarButton('MindTouchDeki_AttachImage',FCKLang.AttachImageLbl,FCKLang.AttachImage,null,false,true,[FCKConfig.DekiCommonPath+"/icons/icons.gif",16,42]);FCKToolbarItems.RegisterItem('MindTouchDeki_AttachImage',oAttachImageItem);
var FCKInsertLinkCommand=function() {};FCKInsertLinkCommand.prototype={GetState:MindTouchDeki.GetState,Execute:function(){var A=this._GetParams();var B=[FCKConfig.DekiCommonPath+'/popups/link_dialog.php','?href='+A.f_href,'&contextID='+FCKConfig.PageId,'&cntxt='+FCKConfig.PageTitle.utf8URL(),'&userName='+FCKConfig.UserName];MindTouchDeki.OpenDialog('InsertLink',B.join(''),"600px","285px",A,this._InsertLink,this);},_GetParams:function(){var A={};this._Link=FCK.Selection.MoveToAncestorNode('A');if (this._Link) FCK.Selection.SelectNode(this._Link);if (!this._Link){var B=MindTouchDeki.GetSelectedText();B=B?B:'';var C=(MindTouchDeki.IsLinkInternal(B))?'./'+encodeURIComponent(B):encodeURI(B);A={'f_href':C,'f_text':B,'contextTopic':FCKConfig.PageTitle,'contextTopicID':FCKConfig.PageId,'userName':FCKConfig.UserName,'newlink':true};}else{if (this._Link.className=='site'){return;};var D=this._Link.getAttribute('_fcksavedurl');if (D==null) D=this._Link.getAttribute('href',2)||'';A={'f_href':D,'f_text':MindTouchDeki.GetInnerText(this._Link),'contextTopic':FCKConfig.PageTitle,'contextTopicID':FCKConfig.PageId,'userName':FCKConfig.UserName};};if (A.f_href.indexOf(MindTouchDeki.InternalPrefix)==0){A.f_href=A.f_href.substr(MindTouchDeki.InternalPrefix.length);};return A;},_InsertLink:function(A){FCKUndo.SaveUndoStep();var B;var C=this._Link;if (!A){return false;};var D=A.f_text;var E=A.f_href;if (0==D.length){D=E;};E=MindTouchDeki.NormalizeUri(E);var F=C?[C]:FCK.CreateLink(E,true);var G=(F.length>0);if (!G){B=D;F=[FCK.InsertElement('a')];};for (var i=0;i<F.length;i++){C=F[i];if (G) B=C.innerHTML;C.href=E;C.innerHTML=B;C.setAttribute('_fcksavedurl',E);MindTouchDeki.NormalizeLink(C);};FCKSelection.SelectNode(F[0]);}};var FCKInsertQuickLinkCommand=function() {};FCKInsertQuickLinkCommand.prototype=new FCKInsertLinkCommand;FCKInsertQuickLinkCommand.prototype.Execute=function(){var A=this._GetParams();this._InsertLink(A);};FCKCommands.RegisterCommand('MindTouchDeki_InsertLink',new FCKInsertLinkCommand);FCKCommands.RegisterCommand('MindTouchDeki_InsertQuickLink',new FCKInsertQuickLinkCommand);var oInsertLinkItem=new FCKToolbarButton('MindTouchDeki_InsertLink',FCKLang.InsertLinkLbl,FCKLang.InsertLink,null,false,true,34);FCKToolbarItems.RegisterItem('MindTouchDeki_InsertLink',oInsertLinkItem);
var FCKInsertTemplateCommand=function() {};FCKInsertTemplateCommand.prototype={GetState:MindTouchDeki.GetState,Execute:function(){var A=FCKConfig.DekiCommonPath+'/popups/select_template.php';var B={ contextTopicID:FCKConfig.PageId };MindTouchDeki.OpenDialog('InsertTemplate',A,"400px","110px",B,this._InsertTemplate,this);},_InsertTemplate:function(A){if (A.f_template){var B=new FCKDomRange(FCK.EditorWindow);B.MoveToSelection();var C=B.StartBlock,clone;if (C&&B.CheckIsCollapsed()&&C.nodeName.toLowerCase()=='p'){C=B.StartBlock;clone=FCKDomTools.CloneElement(C);clone.innerHTML=C.innerHTML;clone.innerHTML=clone.innerHTML.replace(/&nbsp;/ig,' ');FCKDomTools.TrimNode(clone);};FCK.InsertHtml(A.f_template);if (clone){FCKDomTools.TrimNode(C);var D=FCKDomTools.GetLastChild(C);if (clone.innerHTML.length==0){FCKDomTools.RemoveNode(C,true);};if (D){B.MoveToElementEditEnd(D);B.Select();}}}}};FCKCommands.RegisterCommand('MindTouchDeki_InsertTemplate',new FCKInsertTemplateCommand);var oInsertTemplateItem=new FCKToolbarButton('MindTouchDeki_InsertTemplate',FCKLang.Templates,FCKLang.Templates,null,false,true,FCKConfig.DekiCommonPath+"/icons/ed_template.gif");FCKToolbarItems.RegisterItem('MindTouchDeki_InsertTemplate',oInsertTemplateItem);
var FCKInsertExtensionCommand=function() {};FCKInsertExtensionCommand.prototype={GetState:MindTouchDeki.GetState,Execute:function(){var A={'sSelection':MindTouchDeki.GetSelectedText(),'elParent':FCKSelection.GetParentElement()};var B=FCKConfig.DekiCommonPath+'/popups/extension_dialog.php';MindTouchDeki.OpenDialog('InsertExtension',B,"700px","400px",A,this._InsertExtension,this);},_InsertExtension:function(A){FCKUndo.SaveUndoStep();if (A.sDekiScript){FCK.InsertHtml(FCKTools.HTMLEncode(A.sDekiScript));}}};FCKCommands.RegisterCommand('MindTouchDeki_InsertExtension',new FCKInsertExtensionCommand);var oInsertExtensionItem=new FCKToolbarButton('MindTouchDeki_InsertExtension',FCKLang.InsertExtensionLbl,FCKLang.InsertExtension,FCK_TOOLBARITEM_ICONTEXT,false,true,[FCKConfig.DekiCommonPath+"/icons/icons.gif",16,21]);FCKToolbarItems.RegisterItem('MindTouchDeki_InsertExtension',oInsertExtensionItem);
var FCKInsertVideoCommand=function() {};FCKInsertVideoCommand.prototype={GetState:MindTouchDeki.GetState,Execute:function(){var A=FCKConfig.DekiCommonPath+'/popups/popup-video.php';MindTouchDeki.OpenDialog('InsertVideo',A,"400px","118px",null,this._InsertVideo,this);},_InsertVideo:function(A){FCKUndo.SaveUndoStep();if (A.f_content){FCK.InsertHtml('{{media("'+A.f_content+'")}}');};return true;}};FCKCommands.RegisterCommand('MindTouchDeki_InsertVideo',new FCKInsertVideoCommand);var oInsertVideoItem=new FCKToolbarButton('MindTouchDeki_InsertVideo',FCKLang.InsertVideoLbl,FCKLang.InsertVideo,null,false,true,FCKConfig.DekiCommonPath+"/icons/film.png");FCKToolbarItems.RegisterItem('MindTouchDeki_InsertVideo',oInsertVideoItem);
var FCKToolbarTransformContentCombo=function(A,B){if (A===false) return;this.CommandName='TransformContent';this.Label=this.GetLabel();this.Tooltip=A?A:this.Label;this.Style=B?B:FCK_TOOLBARITEM_ICONTEXT;this.PanelWidth=130;this.FieldWidth=130;this.DefaultLabel=FCKLang.NoTransformation||'';};FCKToolbarTransformContentCombo.oTransformCache=null;FCKToolbarTransformContentCombo.prototype=new FCKToolbarSpecialCombo;FCKToolbarTransformContentCombo.prototype.GetLabel=function(){return FCKLang.Transform;};FCKToolbarTransformContentCombo.GetTransformations=function(A){var B={},transform;if (FCKToolbarTransformContentCombo.oTransformCache==null){B['loading']=FCKConfig.Transformations['Loading'];B['loading'].Label=FCKLang.Loading;FCKToolbarTransformContentCombo.LoadTransformations(A);}else{B['notransformation']=FCKConfig.Transformations['NoTransformation'];B['notransformation'].Label=FCKLang.NoTransformation;for (var i=0;i<FCKToolbarTransformContentCombo.oTransformCache.length;i++){transform=FCKToolbarTransformContentCombo.oTransformCache[i];var C=transform.func;var D=(transform.tags)?transform.tags.toLowerCase()+',':'';B[C]={ Function:C,Tags:D };B[C].Label=C;}};return B;};FCKToolbarTransformContentCombo.prototype.CreateItems=function(A){var B=A._Panel.Document;FCKTools.AppendStyleSheet(B,FCKConfig.ToolbarComboPreviewCSS);FCKTools.AppendStyleString(B,FCKConfig.EditorAreaStyles);B.body.className+=' ForceBaseFont';FCKConfig.ApplyBodyAttributes(B.body);FCKToolbarTransformContentCombo.CreateItems(A);A.OnBeforeClick=this.TransformCombo_OnBeforeClick;};FCKToolbarTransformContentCombo.CreateItems=function(A){var B=FCKToolbarTransformContentCombo.GetTransformations(A);for (var C in B){var D=B[C];var E=A.AddItem(C,D.Label||C);E.Transform=D;}};FCKToolbarTransformContentCombo.prototype.RefreshActiveItems=function(A){var B=FCK.ToolbarSet.CurrentInstance.Selection.GetBoundaryParentElement(true);if (B){var C=new FCKElementPath(B);for (var i=0;i<C.Elements.length;i++){var D=C.Elements[i];var E=D.getAttribute('function');if (E){for (var j in A.Items){var F=A.Items[j];var G=F.Transform;if (G.Function==E){if (G.Tags&&G.Tags.Contains(D.nodeName.toLowerCase()+',')){A.SetLabel(G.Label);return;}}}}}};A.SetLabel(this.DefaultLabel);};FCKToolbarTransformContentCombo.prototype.TransformCombo_OnBeforeClick=function(A){A.DeselectAll();var B=FCK.ToolbarSet.CurrentInstance.Selection.GetBoundaryParentElement(true);var C=true;if (!A.Items['loading']){if (B){var D=new FCKElementPath(B);var E,item,transform,tag,sFunction;transformations:for (var i in A.Items){item=A.Items[i];transform=item.Transform;if ('notransformation'==i){item.style.display='';continue transformations;};for (var j=0;j<D.Elements.length;j++){E=D.Elements[j];tag=E.nodeName.toLowerCase()+',';if (transform.Tags&&transform.Tags.Contains(tag)){item.style.display='';sFunction=E.getAttribute('function');if (sFunction==transform.Function){C=false;A.SelectItem(item);};continue transformations;}else{item.style.display='none';}}};if (C){A.SelectItem(A.Items['notransformation']);}}}else{item=A.Items['loading'];item.style.display='';}};FCKToolbarTransformContentCombo.getContentType=function(o){var A=o.getResponseHeader['Content-Type']?o.getResponseHeader['Content-Type']:o.getResponseHeader['Content-type'];var B=A.split(';');return String(B[0]).replace(/\s+$/,'');};FCKToolbarTransformContentCombo.LoadTransformations=function(A){var B=function(o){var C=null;var D=FCKToolbarTransformContentCombo.getContentType(o);if ('application/json'==D){try{C=parent.YAHOO.lang.JSON.parse(o.responseText);FCKToolbarTransformContentCombo.oTransformCache=C.body;var E=A._Panel.CheckIsOpened();A._Panel.Hide();A.ClearItems();FCKToolbarTransformContentCombo.CreateItems(A);if (E){var F=parent.YAHOO.util.Dom.getElementsByClassName('SC_Field','div',A._OuterTable);FCKSpecialCombo_OnClick.call(F[0],null,A);};return;}catch (e) {}};G();};var G=function(o) {};var H={'success':B,'failure':G,'timeout':6000};var I=parent.YAHOO.util.Connect.asyncRequest('GET','/deki/gui/editor.php?method=transform',H,null);};var FCKTransformCommand=function(){};FCKTransformCommand.prototype={Name:'TransformContent',Execute:function(A,B){var C=parent.YAHOO;if (A!='loading'){FCKUndo.SaveUndoStep();var D=FCK.ToolbarSet.CurrentInstance.Selection.GetBoundaryParentElement(true);if (D){var E=new FCKElementPath(D);var F=B.Transform;for (var i=0;i<E.Elements.length;i++){var G=E.Elements[i];if (F.Tags&&F.Tags.Contains(G.nodeName.toLowerCase()+',')){C.util.Dom.addClass(G,'deki-transform');G.setAttribute('function',A);break;}else if (A=='notransformation'){if (FCKDomTools.HasAttribute(G,'function')){C.util.Dom.removeClass(G,'deki-transform');G.removeAttribute('function',0);break;}}}};FCKUndo.SaveUndoStep();};FCK.Focus();FCK.Events.FireEvent('OnSelectionChange');},GetState:MindTouchDeki.GetState};FCKCommands.RegisterCommand('TransformContent',new FCKTransformCommand);var oTransformItem=new FCKToolbarTransformContentCombo(null,FCK_TOOLBARITEM_ONLYTEXT);FCKToolbarItems.RegisterItem('MindTouchDeki_Transform',oTransformItem);
var FindReplace=function(){this.FindRange=null;};FindReplace.prototype={_Find:function(A,B,C,D){C=(C)?C:false;D=(D)?D:false;if (!this.FindRange) this.FindRange=new FindReplace.CharacterRange(new FindReplace.CharacterCursor(A),B.length);else{this.FindRange=this.FindRange.GetNextRange(B.length);};var E=new FindReplace.KmpMatch(B,!C);var F=FindReplace.KMP_NOMATCH;var G='%';while (G!=null){while ((G=this.FindRange.GetEndCharacter())){F=E.FeedCharacter(G);if (F==FindReplace.KMP_MATCHED) break;if (this.FindRange.MoveNext()) E.Reset();};if (F==FindReplace.KMP_MATCHED){if (D){var H=this.FindRange.GetCursors();var I=H[H.length-1].Clone();var J=H[0].Clone();if (!I.MoveNext()&&!FindReplace.CheckIsWordSeparator(I.GetCharacter())) continue;if (!J.MoveBack()&&!FindReplace.CheckIsWordSeparator(J.GetCharacter())) continue;};return true;}};this.FindRange=null;return false;},Find:function(A,B,C,D){return this._Find(A,B,C,D)},Replace:function(A,B,C,D,E){var F=function(selectRange){var G;if (FCKBrowserInfo.IsIE) G=document.selection.createRange();selectRange.Select();FCKUndo.SaveUndoStep();var H=selectRange.Clone();H.Collapse(false);H.Select();if (G) setTimeout(function(){ G.select();},1);};if (this._Find(A,B,D,E)){var I=this.FindRange.ToDomRange();var J=I.CreateBookmark();I.MoveToBookmark(J);F(I);I.DeleteContents();for (var i=0;i<C.length;i++){I.InsertNode(C[i]);I.MoveToPosition(C[i],4);};I._UpdateElementInfo();this.FindRange=CharacterRange.CreateFromDomRange(I);};return;},ReplaceAll:function(A,B,C,D,E,F){var G=0;while (this._Find(A,B,D,E)){var H=this.FindRange.ToDomRange();var I=new FCKElementPath(H.StartNode);var J=false;for (var i=0;i<I.Elements.length;i++){var K=I.Elements[i];if (/plain/.test(FCKDomTools.GetAttributeValue(K,'class'))){J=true;break;}};var L=H.CreateBookmark();H.MoveToBookmark(L);H.Select();if (!J||F){FCKUndo.SaveUndoStep();H.DeleteContents();for (var i=0;i<C.length;i++){H.InsertNode(C[i]);H.MoveToPosition(C[i],4);};H._UpdateElementInfo();}else{H.Collapse(false);};this.FindRange=FindReplace.CharacterRange.CreateFromDomRange(H);G++;};return G;}};FindReplace.GetNextNonEmptyTextNode=function(A,B){while ((A=FCKDomTools.GetNextSourceNode(A,false,3,B))&&A&&A.length<1) 1;return A;};FindReplace.CharacterCursor=function(A){if (A.nodeType&&A.nodeType!=3){this._textNode=FindReplace.GetNextNonEmptyTextNode(A,A);this._offset=0;}else{this._textNode=arguments[0];this._offset=arguments[1];}};FindReplace.CharacterCursor.prototype={GetCharacter:function(){return (this._textNode&&this._textNode.nodeValue.charAt(this._offset))||null;},GetTextNode:function(){return this._textNode;},GetIndex:function(){return this._offset;},MoveNext:function(){if (this._offset<this._textNode.length-1){this._offset++;return false;};var A=false;var B=this._textNode;while ((B=FCKDomTools.GetNextSourceNode(B))&&B&&(B.nodeType!=3||B.length<1)){var C=B.nodeName.toLowerCase();if (FCKListsLib.BlockElements[C]||C=='br') A=true;};this._textNode=B;this._offset=0;return A;},MoveBack:function(){if (this._offset>0&&this._textNode.length>0){this._offset=Math.min(this._offset-1,this._textNode.length-1);return false;};var A=false;var B=this._textNode;while ((B=FCKDomTools.GetPreviousSourceNode(B))&&B&&(B.nodeType!=3||B.length<1)){var C=B.nodeName.toLowerCase();if (FCKListsLib.BlockElements[C]||C=='br') A=true;};this._textNode=B;this._offset=B&&B.length-1;return A;},Clone:function(){return new FindReplace.CharacterCursor(this._textNode,this._offset);}};FindReplace.CharacterRange=function(A,B){this._cursors=A.push?A:[A];this._maxLength=B;};FindReplace.CharacterRange.prototype={ToDomRange:function(){var A=this._cursors[0];var B=this._cursors[this._cursors.length-1];var C=new FCKDomRange(FCKTools.GetElementWindow(A.GetTextNode()));var D=C._Range=C.CreateRange();D.setStart(A.GetTextNode(),A.GetIndex());D.setEnd(B.GetTextNode(),B.GetIndex()+1);C._UpdateElementInfo();return C;},MoveNext:function(){var A=this._cursors[this._cursors.length-1].Clone();var B=A.MoveNext();if (B) this._cursors=[];this._cursors.push(A);if (this._cursors.length>this._maxLength) this._cursors.shift();return B;},MoveBack:function(){var A=this._cursors[0].Clone();var B=A.MoveBack();if (B) this._cursors=[];this._cursors.unshift(A);if (this._cursors.length>this._maxLength) this._cursors.pop();return B;},GetEndCharacter:function(){if (this._cursors.length<1) return null;var A=this._cursors[this._cursors.length-1].GetCharacter();return A;},GetNextRange:function(A){if (this._cursors.length==0) return null;var B=this._cursors[this._cursors.length-1].Clone();B.MoveNext();return new FindReplace.CharacterRange(B,A);},GetCursors:function(){return this._cursors;}};FindReplace.CharacterRange.CreateFromDomRange=function(A){var B=A._Range;var C=B.startContainer;var D=B.endContainer;var E,startIndex,endTextNode,endIndex;if (C.nodeType==3){E=C;startIndex=B.startOffset;}else if (A.StartNode.nodeType==3){E=A.StartNode;startIndex=0;}else{E=FindReplace.GetNextNonEmptyTextNode(A.StartNode,A.StartNode.parentNode);if (!E) return null;startIndex=0;};if (D.nodeType==3&&B.endOffset>0){endTextNode=D;endIndex=B.endOffset-1;}else{endTextNode=A.EndNode;while (endTextNode.nodeType!=3) endTextNode=endTextNode.lastChild;endIndex=endTextNode.length-1;};var F=[];var G=new FindReplace.CharacterCursor(E,startIndex);F.push(G);if (!(G.GetTextNode()==endTextNode&&G.GetIndex()==endIndex)&&!A.CheckIsEmpty()){do{G=G.Clone();G.MoveNext();F.push(G);}while (!(G.GetTextNode()==endTextNode&&G.GetIndex()==endIndex));};return new FindReplace.CharacterRange(F,F.length);};FindReplace.KMP_NOMATCH=0;FindReplace.KMP_ADVANCED=1;FindReplace.KMP_MATCHED=2;FindReplace.KmpMatch=function(A,B){var C=[-1];for (var i=0;i<A.length;i++){C.push(C[i]+1);while (C[i+1]>0&&A.charAt(i)!=A.charAt(C[i+1]-1)) C[i+1]=C[C[i+1]-1]+1;};this._Overlap=C;this._State=0;this._IgnoreCase=(B===true);if (B) this.Pattern=A.toLowerCase();else this.Pattern=A;};FindReplace.KmpMatch.prototype={FeedCharacter:function(c){if (this._IgnoreCase) c=c.toLowerCase();while (true){if (c==this.Pattern.charAt(this._State)){this._State++;if (this._State==this.Pattern.length){this._State=0;return FindReplace.KMP_MATCHED;};return FindReplace.KMP_ADVANCED;}else if (this._State==0) return FindReplace.KMP_NOMATCH;else this._State=this._Overlap[this._State];};return null;},Reset:function(){this._State=0;}};FindReplace.CheckIsWordSeparator=function(c){if (!c) return true;var A=c.charCodeAt(0);if (A>=9&&A<=0xd) return true;if (A>=0x2000&&A<=0x200a) return true;switch (A){case 0x20:case 0x85:case 0xa0:case 0x1680:case 0x180e:case 0x2028:case 0x2029:case 0x202f:case 0x205f:case 0x3000:return true;default:};return /[.,"'?!;:]/.test(c);};
var ConvertTextToTable=function() {};ConvertTextToTable.prototype={Execute:function(){var A=FCK.EditorDocument;FCKUndo.SaveUndoStep();var B=new FCKDomRange(FCK.EditorWindow);B.MoveToSelection();var C=new FCKDomRangeIterator(B.Clone());var D;var E=[];while ((D=C.GetNextParagraph())){E.push(D);};var F,position;F=FCKTools.GetLastItem(E);if (F){F=F.nextSibling;position="before";};if (!F){F=A.body;position="child";};var G=A.createElement('TABLE');G.cellSpacing=1;G.cellPadding=1;G.border=1;if (F){switch (position){case "before":F.parentNode.insertBefore(G,F);break;case "child":F.appendChild(G);break;}};for (var i=0;i<E.length;i++){var H=G.insertRow(-1).insertCell(-1);H.innerHTML=E[i].innerHTML;FCKDomTools.RemoveNode(E[i]);};B.SetStart(G.rows[0].cells[0],1);var I=G.rows.length-1;B.SetEnd(G.rows[I].cells[G.rows[I].cells.length-1],2);B.Select();B.Release();FCK.Focus();FCK.Events.FireEvent('OnSelectionChange');},GetState:function(){if (FCK.EditorDocument!=null){var A=FCKSelection.HasAncestorNode('TABLE');switch (this.Name){case 'TableToText':return (A)?FCK_TRISTATE_OFF:FCK_TRISTATE_DISABLED;break;case 'TextToTable':return (A)?FCK_TRISTATE_DISABLED:FCK_TRISTATE_OFF;break;default:return FCK_TRISTATE_OFF;}}else return FCK_TRISTATE_DISABLED;}};FCKCommands.RegisterCommand('TableToText',new FCKDialogCommand(FCKLang['TableToText'],FCKLang['TableToText'],FCKConfig.PluginsPath+'tableconvert/tabletotext.html',340,170));FCKCommands.RegisterCommand('TextToTable',new ConvertTextToTable);FCK.ContextMenu.RegisterListener({AddItems:function(A,B,C){var D=(C=='TABLE'||FCKSelection.HasAncestorNode('TABLE'));if (D){A.AddSeparator();A.AddItem('TableToText',FCKLang.TableToText,null,FCKCommands.GetCommand('Table').GetState()==FCK_TRISTATE_DISABLED);}else if (FCKCommands.GetCommand('Table').GetState()!=FCK_TRISTATE_DISABLED){A.AddSeparator();A.AddItem('TextToTable',FCKLang.TextToTable,null);}}});
(function() {var A=FCKConfig.PluginsPath+'tableoperations/';FCKCommands.RegisterCommand('Table',new FCKDialogCommand('Table',FCKLang.DlgInsertTableTitle,A+'fck_table.html',500,330));FCKCommands.RegisterCommand('TableProp',new FCKDialogCommand('Table',FCKLang.DlgTableTitle,A+'fck_table.html?Parent',500,330));FCKCommands.RegisterCommand('TableCellProp',new FCKDialogCommand('TableCell',FCKLang.DlgCellTitle,A+'fck_tablecell.html',550,300));FCKCommands.RegisterCommand('TableRowProp',new FCKDialogCommand('TableRow',FCKLang.DlgRowTitle,A+'fck_tablerow.html',450,290));FCKToolbarItems.RegisterItem('TableRowProp',new FCKToolbarButton('TableRowProp',FCKLang.RowProperties,null,null,null,true,A+'fck_rowprop.gif'));FCK.ContextMenu.RegisterListener({AddItems:function(menu,tag,tagName){var B=(tagName=='TABLE');var C=(!B&&FCKSelection.HasAncestorNode('TABLE'));if (C) {for (var i=0;i<menu._MenuBlock._Items.length;i++) {var D=menu._MenuBlock._Items[i];if (D.Name=='Row') {D.AddSeparator();D.AddItem('TableRowProp',FCKLang.RowProperties,A+'fck_rowprop.gif',FCKCommands.GetCommand('TableRowProp').GetState()==FCK_TRISTATE_DISABLED);}}}}});if (!FCKCodeFormatter.Regex) FCKCodeFormatter.Init();FCKCodeFormatter.Regex.MainTags=/\<\/?(HTML|HEAD|BODY|FORM|TABLE|TBODY|THEAD|TFOOT|TR)[^\>]*\>/gi;FCKCodeFormatter.Regex.IncreaseIndent=/^\<(HTML|HEAD|BODY|FORM|TABLE|TBODY|THEAD|TFOOT|TR|UL|OL|DL)[ \/\>]/i;FCKCodeFormatter.Regex.DecreaseIndent=/^\<\/(HTML|HEAD|BODY|FORM|TABLE|TBODY|THEAD|TFOOT|TR|UL|OL|DL)[ \>]/i;})();
